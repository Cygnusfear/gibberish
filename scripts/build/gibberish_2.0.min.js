function AudioFileRequest(i,e){this.url=i,(e===void 0||null==e)&&(e=!0),this.async=e;var t=i.split(".");this.extension=t[t.length-1].toLowerCase()}function Decoder(){}function WAVDecoder(){}function AIFFDecoder(){}Gibberish={memo:{},functions:{},upvalues:[],codeblock:[],analysisCodeblock:[],analysisUgens:[],dirtied:[],id:0,isDirty:!1,out:null,debug:!1,callback:"",audioFiles:{},createCallback:function(){this.memo={},this.codeblock.length=0;for(var i=0;this.dirtied.length>i;i++)this.dirtied[i].codegen();if(this.dirtied.length=0,this.codestring=this.upvalues.join(""),this.codestring+="\nGibberish.callback = function() {\n	",this.memo={},this.out.getCodeblock(),this.codestring+=this.codeblock.join("	"),this.codestring+="\n	",this.codeblock.length=0,this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var i=0;this.analysisUgens.length>i;i++)this.codeblock.length=0,this.analysisUgens[i].codegen2(),this.codestring+=this.codeblock.join(""),this.codestring+="\n	",this.analysisCodeblock.push(this.analysisUgens[i].analysisCodegen());this.codestring+=this.analysisCodeblock.join("\n	"),this.codestring+="\n\n	"}this.codestring+="return "+this.out.variable+";\n",this.codestring+="}",this.callbackString=this.codestring,this.debug&&console.log(this.callbackString),eval(this.codestring)},audioProcess:function(t){for(var n=t.outputBuffer.getChannelData(0),s=t.outputBuffer.getChannelData(1),e=Gibberish,i=0,o=t.outputBuffer.length;o>i;i++){e.isDirty&&(e.createCallback(),e.isDirty=!1);var r=e.callback();n[i]=r[0],s[i]=r[1]}},clear:function(){this.upvalues.length=1,this.out.inputs.length=0,this.analysisUgens.length=0,Gibberish.dirty(this.out)},dirty:function(e){if(e!==void 0){for(var t=!1,i=0;this.dirtied.length>i;i++)this.dirtied[i].variable===e.variable&&(t=!0);t||(this.isDirty=!0,this.dirtied.push(e))}else this.isDirty=!0},generateSymbol:function(e){return e+"_"+this.id++},init:function(){Gibberish.out=new Gibberish.Bus2,Gibberish.dirty(Gibberish.out);var e=arguments[0]===void 0?1024:arguments[0];return start=function(){if(alert("start, "+e),document.getElementsByTagName("body")[0].removeEventListener("touchstart",start),Gibberish.context=new webkitAudioContext,Gibberish.node=Gibberish.context.createJavaScriptNode(e,2,2,44100),Gibberish.node.onaudioprocess=Gibberish.audioProcess,Gibberish.node.connect(Gibberish.context.destination),"ontouchstart"in document.documentElement){var i=Gibberish.context.createBufferSource();i.connect(Gibberish.context.destination),i.noteOn(0)}},"ontouchstart"in document.documentElement?document.getElementsByTagName("body")[0].addEventListener("touchstart",start):start(),this},makePanner:function(){var e=Math.sin,i=Math.cos,t=Math.sqrt(2)/2,r=function(r,n,s){var o="object"==typeof r,a=o?r[0]:r,h=o?r[1]:r;return s[0]=a*t*(i(n)-e(n)),s[1]=h*t*(i(n)+e(n)),s};return r},polyInit:function(e){e.mod=e.polyMod,e.removeMod=e.removePolyMod;for(var i in e.polyProperties)(function(i){var t=e.polyProperties[i];Object.defineProperty(e,i,{get:function(){return t},set:function(n){t=n;for(var r=0;e.children.length>r;r++)e.children[r][i]=t}})})(i)},interpolate:function(){var e=Math.floor;return function(t,n){var r=e(n),i=r+1,s=n-r;return i=t.length>i?i:0,t[r]*(1-s)+t[i]*s}}(),ugen:function(){Gibberish.extend(this,{processProperties:function(){if("object"!=typeof arguments[0][0]||arguments[0][0].type!==void 0||Array.isArray(arguments[0][0])){var i=0;for(var e in this.properties)"object"==typeof this.properties[e]&&this.properties[e].binops!==void 0?arguments[0][i]!==void 0&&(this.properties[e].value=arguments[0][i++]):arguments[0][i]!==void 0&&(this.properties[e]=arguments[0][i++])}else{var t=arguments[0][0];for(var e in t)t[e]!==void 0&&("object"==typeof this.properties[e]&&this.properties[e].binops!==void 0?this.properties[e].value=t[e]:this[e]=t[e])}return this},codegen:function(){var e="",n=null;if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];n=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=n,this.variable=n,e+="var "+n+" = "+this.symbol+"(";for(var b in this.properties){var i=this.properties[b],r="";if("single_sample_delay"===this.name&&console.log("SSD PROP"+b),Array.isArray(i.value)){0===i.value.length&&(r=0);for(var s=0;i.value.length>s;s++){var o=i.value[s];r+="object"==typeof o?null!==o?o.codegen():"null":o,r+=i.value.length-1>s?", ":""}}else r="object"==typeof i.value?null!==i.value?i.value.codegen():"null":i.value;if(e+=r,i.binops)for(var h=0;i.binops.length>h;h++){var a,t=i.binops[h];a="number"==typeof t.ugen?t.ugen:null!==t.ugen?t.ugen.codegen():"null","="===t.binop?(e=e.replace(r,""),e+=a):"++"===t.binop?(Gibberish.upvalues.push("var abs = Math.abs\n;"),e+=" + abs("+a+")"):e+=" "+t.binop+" "+a}e+=", "}return" "===e.charAt(e.length-1)&&(e=e.slice(0,-2)),e+=");\n",null===this.codeblock&&Gibberish.upvalues.pushUnique("var "+this.symbol+" = Gibberish.functions."+this.symbol+";\n"),this.codeblock=e,this.dirty=!1,n},getCodeblock:function(){if(null!==this&&(null===this.codeblock&&this.codegen(),!Gibberish.memo[this.symbol])){if(Gibberish.memo[this.symbol]=this.variable,"analysis"!==this.type)for(var o in this.properties){var e=this.properties[o];if(Array.isArray(e.value))for(var s=e.value,i=0;s.length>i;i++){var t=s[i];"object"==typeof t&&null!==t&&t.getCodeblock()}else"object"==typeof e.value&&null!==e.value&&e.value.getCodeblock();if(e.binops)for(var r=0;e.binops.length>r;r++){var n=e.binops[r];"object"==typeof n.ugen&&null!==n.ugen&&n.ugen.getCodeblock()}}return"analysis"===this.type?Gibberish.codeblock.unshift(this.codeblock):Gibberish.codeblock.push(this.codeblock),this.variable}},defineUgenProperty:function(e,i){this.properties[e]={symbol:Gibberish.generateSymbol("v"),value:i,binops:[],getCodeblock:function(){"number"!=typeof this.value&&Gibberish.codeblock.push("var "+this.symbol+" = "+this.value+";\n")},codegen:function(){return"number"==typeof this.value||"string"==typeof this.value?this.value:this.symbol},parent:this,name:e},function(i){var t=e;Object.defineProperty(i,t,{configurable:!0,get:function(){return i.properties[t].value},set:function(e){i.properties[t].value=e,Gibberish.dirty(i)}})}(this)},init:function(i){if(i===void 0&&(i=!1),this.initalized||(this.symbol=Gibberish.generateSymbol(this.name),this.codeblock=null,this.variable=null),this.properties===void 0&&(this.properties={}),!this.initialized){this.destinations=[];for(var e in this.properties)this.defineUgenProperty(e,this.properties[e])}if(arguments.length>0&&"object"==typeof arguments[0][0]&&"undefined"===arguments[0][0].type){var t=arguments[0][0];for(var e in t)this[e]=t[e]}return Gibberish.functions[this.symbol]=this.callback,this.initialized=!0,this},mod:function(e,i,t){var r=this.properties[e],n={ugen:i,binop:t};r.binops.push(n),Gibberish.dirty(this)},removeMod:function(e,i){if(i===void 0)this.properties[e].binops.length=0;else if("number"==typeof i)this.properties[e].binops.splice(i,1);else if("object"==typeof i)for(var t=0,r=this.properties[e].binops.length;r>t;t++)this.properties[e].binops[t].ugen===i&&this.properties[e].binops.splice(t,1);Gibberish.dirty(this)},polyMod:function(i,t,r){for(var e=0;this.children.length>e;e++)this.children[e].mod(i,t,r);Gibberish.dirty(this)},removePolyMod:function(){var i=Array.prototype.slice.call(arguments,0);if("amp"!==arguments[0]&&"pan"!==arguments[0])for(var e=0;this.children.length>e;e++)this.children[e].removeMod.apply(this.children[e],i);else this.removeMod.apply(this,i);Gibberish.dirty(this)},smooth:function(e){var i=new Gibberish.OnePole;this.mod(e,i,"=")},connect:function(e){return e===void 0&&(e=Gibberish.out),-1===this.destinations.indexOf(e)&&(e.addConnection(this,1),this.destinations.push(e)),this},send:function(e,i){return-1===this.destinations.indexOf(e)?(e.addConnection(this,i),this.destinations.push(e)):e.adjustSendAmount(this,i),this},disconnect:function(i){if(i===void 0)for(var e=0;this.destinations.length>e;e++)this.destinations[e].removeConnection(this),this.destiGibbenations.splice(e);else i.removeConnection(this);return this}})}},Array2=function(){this.length=0},Array2.prototype=[],Array2.prototype.remove=function(i,t){if(t=t===void 0?!0:t,i===void 0){for(var e=0;this.length>e;e++)delete this[e];this.length=0}else if("number"==typeof i)this.splice(i,1);else if("string"==typeof i){for(var r=[],e=0;this.length>e;e++){var s=this[e];if(s.type===i||s.name===i){if(!t)return this.splice(e,1),void 0;r.push(e)}}for(var e=0;r.length>e;e++)this.splice(r[e],1)}else if("object"==typeof i)for(var n=this.indexOf(i);n>-1;)this.splice(n,1),n=this.indexOf(i);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.get=function(e){if("number"==typeof e)return this[e];if("string"==typeof e)for(var i=0;this.length>i;i++){var t=this[i];if(t.name===e)return t}else if("object"==typeof e){var r=this.indexOf(e);if(r>-1)return this[r]}return null},Array2.prototype.replace=function(e,i){if(i.parent=this,i.input=e.input,"number"!=typeof e){var t=this.indexOf(e);t>-1&&this.splice(t,1,i)}else this.splice(e,1,i);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.insert=function(e,t){if(e.parent=this,this.input=this.parent,Array.isArray(e))for(var i=0;e.length>i;i++)this.splice(t+i,0,e[i]);else this.splice(t,0,e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.add=function(){for(var e=0;arguments.length>e;e++)arguments[e].parent=this,arguments[e].input=this.parent,this.push(arguments[e]);this.parent&&(console.log("DIRTYING"),Gibberish.dirty(this.parent))},Array.prototype.pushUnique=function(){for(var e=0;arguments.length>e;e++){for(var t=arguments[e],r=!0,i=0;this.length>i;i++)if(t===this[i]){r=!1;break}r&&this.push(t)}};var rnd=Math.random;Gibberish.rndf=function(e,i,n,r){if(r=r===void 0?!0:r,n===void 0&&"object"!=typeof e){1==arguments.length?(e=0,i=arguments[0]):2==arguments.length?(e=arguments[0],i=arguments[1]):(e=0,i=1);var h=i-e,l=rnd(),b=h*l;return e+b}var s=[],o=[];n===void 0&&(n=i||e.length);for(var a=0;n>a;a++){var t;if("object"==typeof arguments[0])t=arguments[0][randomi(0,arguments[0].length-1)];else if(r)t=Gibberish.rndf(e,i);else{for(t=Gibberish.rndf(e,i);o.indexOf(t)>-1;)t=Gibberish.rndf(e,i);o.push(t)}s.push(t)}return s},Gibberish.extend=function(t,i){for(var e in i)e.split("."),i[e]instanceof Array&&100>i[e].length?(t[e]=i[e].slice(0),"fx"===e&&(t[e].parent=i[e].parent)):"object"!=typeof i[e]||null===i[e]||i[e]instanceof Float32Array?t[e]=i[e]:(t[e]=t[e]||{},arguments.callee(t[e],i[e]));return t},Function.prototype.clone=function(){return eval("["+(""+this)+"]")[0]},String.prototype.format=function(e,i,t){function r(){var r=this,n=arguments.length+1;for(e=0;n>e;t=arguments[e++])i=t,r=r.replace(RegExp("\\{"+(e-1)+"\\}","g"),i);return r}return r.native=String.prototype.format,r}(),Gibberish.Proxy=function(){var e=0;Gibberish.extend(this,{name:"proxy",type:"effect",properties:{},callback:function(){return e}}).init(),this.input=arguments[0],e=this.input.parent[this.input.name],delete this.input.parent[this.input.name],this.input.parent.properties[this.input.name].value=this,Object.defineProperty(this.input.parent,this.input.name,{get:function(){return e},set:function(i){e=i}}),Gibberish.dirty(this.input.parent)},Gibberish.Proxy.prototype=new Gibberish.ugen,Gibberish.oscillator=function(){this.type="oscillator",this.oscillatorInit=function(){return this.fx=new Array2,this.fx.parent=this,this}},Gibberish.oscillator.prototype=new Gibberish.ugen,Gibberish._oscillator=new Gibberish.oscillator,Gibberish.Sine=function(){this.name="sine",this.properties={frequency:arguments[0]||440,amp:arguments[1]||.5};var i=2*Math.PI,t=Math.sin,e=0;this.callback=function(r,n){return e+=r/44100,t(e*i)*n},this.init(arguments),this.oscillatorInit()},Gibberish.Sine.prototype=Gibberish._oscillator,Gibberish.Sine2=function(){this.__proto__=new Gibberish.Sine,this.name="sine2",this.defineUgenProperty("pan",0);var i=this.__proto__.callback,t=Gibberish.makePanner(),e=[0,0];this.callback=function(r,n,s){var o=i(r,n);return e=t(o,s,e)},this.init()},Gibberish.Saw=function(){this.name="saw",this.properties={frequency:440,amp:.15};var e=0;this.callback=function(t,r){var i=4*((e/2+.25)%.5-.25);return i*=r,e+=t/44100,e=e>1?e%1:e,i},this.init(),this.oscillatorInit()},Gibberish.Saw.prototype=Gibberish._oscillator,Gibberish.Saw2=function(){this.__proto__=new Gibberish.Saw,this.name="saw2",this.defineUgenProperty("pan",0);var i=this.__proto__.callback,t=Gibberish.makePanner(),e=[0,0];this.callback=function(r,n,s){var o=i(r,n);return e=t(o,s,e)},this.init()},Gibberish.Triangle=function(){var e=0,i=Math.abs;Gibberish.extend(this,{name:"triangle",properties:{frequency:440,amp:.15},callback:function(r,n){var t=1-4*i((e+.25)%1-.5);return t*=n,e+=r/44100,e=e>1?e%1:e,t}}).init().oscillatorInit()},Gibberish.Triangle.prototype=Gibberish._oscillator,Gibberish.Triangle2=function(){this.__proto__=new Gibberish.Triangle,this.name="triangle2",this.defineUgenProperty("pan",0);var e=this.__proto__.callback,i=Gibberish.makePanner(),t=[0,0];this.callback=function(r,n,s){var o=e(r,n);return i(o,s,t)},this.init()},Gibberish.Saw3=function(){var e=0,i=0,n=2.5,s=-1.5,r=0,o=Math.sin,t=11;pi_2=2*Math.PI,Gibberish.extend(this,{name:"saw",properties:{frequency:440,amp:.15},callback:function(l){var a=l/44100,h=.5-a,u=t*h*h*h*h,c=.376-.752*a,p=1-2*a,b=0;return i+=a,i-=i>1?2:0,e=.5*(e+o(pi_2*(i+e*u))),b=n*e+s*r,r=e,b+=c,b*p}}),Object.defineProperty(this,"scale",{get:function(){return t},set:function(e){t=e}}),this.init(),this.oscillatorInit()},Gibberish.Saw3.prototype=Gibberish._oscillator,Gibberish.PWM=function(){var e=0,i=0,n=0,s=0,t=0,a=2.5,h=-1.5,o=Math.sin,r=11;pi_2=2*Math.PI,test=0,Gibberish.extend(this,{name:"pwm",properties:{frequency:440,amp:.15,pulsewidth:.5},callback:function(p,f,d){var u=p/44100,b=.5-u,c=r*b*b*b*b,m=1-2*u,l=0;return t+=u,t-=t>1?2:0,e=.5*(e+o(pi_2*(t+e*c))),i=.5*(i+o(pi_2*(t+i*c+d))),l=i-e,l=a*l+h*(n-s),n=e,s=i,l*m*f}}),Object.defineProperty(this,"scale",{get:function(){return r},set:function(e){r=e}}),this.init(),this.oscillatorInit()},Gibberish.PWM.prototype=Gibberish._oscillator,Gibberish.Noise=function(){var e=Math.random;Gibberish.extend(this,{name:"noise",properties:{amp:1},callback:function(){return 2*e()-1}}),this.init(),this.oscillatorInit()},Gibberish.Noise.prototype=Gibberish._oscillator,Gibberish.KarplusStrong=function(){var e=[0],i=0,t=Math.random,r=Gibberish.makePanner(),n=[0,0];Gibberish.extend(this,{name:"karplus_strong",properties:{blend:1,damping:0,amp:1,channels:2,pan:0},note:function(t){var r=Math.floor(44100/t);e.length=0;for(var i=0;r>i;i++)e[i]=2*Math.random()-1},callback:function(a,o,h,b,l){var u=e.shift(),c=t()>a?-1:1;o=o>0?o:0;var s=c*(u+i)*(.5-o/100);return i=s,e.push(s),s*=h,1===b?s:r(s,l,n)}}).init().oscillatorInit()},Gibberish.KarplusStrong.prototype=Gibberish._oscillator,Gibberish.PolyKarplusStrong=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"poly_karplus_strong",maxVoices:5,voiceCount:0,polyProperties:{blend:1,damping:0},note:function(e,i){var t=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),t.note(e,i)}}),this.amp=1/this.maxVoices,this.processProperties(arguments),this.children=[],this.dirty=!0;for(var e=0;this.maxVoices>e;e++){var i={blend:this.blend,damping:this.damping,channels:2,amp:1},t=new Gibberish.KarplusStrong(i).connect(this);this.children.push(t)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},Gibberish.bus=function(){this.type="bus",this.inputCodegen=function(){var e=this.value.codegen(),i=1===this.amp?e:e+" * "+this.amp;return this.codeblock=i,i},this.addConnection=function(){var e={value:arguments[0],amp:arguments[1],codegen:this.inputCodegen};e.getCodeblock=e.value.getCodeblock.bind(e.value),this.inputs.push(e),Gibberish.dirty(this)},this.removeConnection=function(i){for(var e=0;this.inputs.length>e;e++)if(this.inputs[e].value===i){this.inputs.splice(e,1),Gibberish.dirty(this);break}},this.adjustSendAmount=function(i,t){for(var e=0;this.inputs.length>e;e++)if(this.inputs[e].value===i){this.inputs[e].amp=t,Gibberish.dirty(this);break}},this.callback=function(){var i=arguments[arguments.length-2],r=arguments[arguments.length-1];output[0]=output[1]=0;for(var e=0;arguments.length-2>e;e++){var t="object"==typeof arguments[e];output[0]+=t?arguments[e][0]:arguments[e],output[1]+=t?arguments[e][1]:arguments[e]}return output[0]*=i,output[1]*=i,panner(output,r,output)}},Gibberish.bus.prototype=new Gibberish.ugen,Gibberish._bus=new Gibberish.bus,Gibberish.Bus=function(){return Gibberish.extend(this,{name:"bus",properties:{inputs:[],amp:arguments[1]||1},callback:function(){for(var i=0,t=arguments.length-1,r=arguments[t],e=0;t>e;e++)i+=args[e];return i*=r}}),this.init(),this},Gibberish.Bus.prototype=Gibberish._bus,Gibberish.Bus2=function(){this.name="bus2",this.type="bus",this.properties={inputs:[],amp:arguments[1]||1,pan:0};var e=[0,0],i=Gibberish.makePanner();this.callback=function(){var r=arguments[arguments.length-2],s=arguments[arguments.length-1];e[0]=e[1]=0;for(var t=0;arguments.length-2>t;t++){var n="object"==typeof arguments[t];e[0]+=n?arguments[t][0]:arguments[t],e[1]+=n?arguments[t][1]:arguments[t]}return e[0]*=r,e[1]*=r,i(e,s,e)},this.initialized=!1,this.init()},Gibberish.Bus2.prototype=Gibberish._bus,Gibberish.envelope=function(){this.type="envelope"},Gibberish.envelope.prototype=new Gibberish.ugen,Gibberish._envelope=new Gibberish.envelope,Gibberish.Line=function(t,i,r,n){var s={name:"line",properties:{start:t||0,end:isNaN(i)?1:i,time:r||44100,loops:n||!1}},e=0,o=(i-t)/r;return this.callback=function(r,i,n,s){var t=n>e?r+e++*o:i;return e=t>=i&&s?0:e,t},Gibberish.extend(this,s),this.init(),this},Gibberish.Line.prototype=Gibberish._envelope,Gibberish.AD=function(t,r){var e=0,i=0;Gibberish.extend(this,{name:"AD",properties:{attack:t||1e4,decay:r||1e4},run:function(){return i=0,e=0,this},callback:function(t,r){if(t=0>t?_4:t,r=0>r?_4:r,0===i){var n=1/t;e+=n,e>=1&&i++}else if(1===i){var n=1/r;e-=n,0>=e&&(e=0,i++)}return e},getState:function(){return i}}).init().processProperties(arguments)},Gibberish.AD.prototype=Gibberish._envelope,Gibberish.ADSR=function(t,r,n,s,o,a){var h={name:"adsr",type:"envelope",properties:{attack:isNaN(t)?1e4:t,decay:isNaN(r)?1e4:r,release:isNaN(s)?1e4:s,sustain:n===void 0?88200:n,attackLevel:o||1,sustainLevel:a||.5},run:function(){this.setPhase(0),this.setState(0)}};Gibberish.extend(this,h);var e=0,i=0;return this.callback=function(s,o,a,n,h,r){var t=0;return 0===i?(t=e/s*h,1===++e/s&&(i++,e=o)):1===i?(t=e/o*(h-r)+r,0>=--e&&(null!==a?(i+=1,e=a):(i+=2,e=n))):2===i?(t=r,0===e--&&(i++,e=n)):3===i&&(e--,t=e/n*r,0>=e&&i++),t},this.setPhase=function(i){e=i},this.setState=function(t){i=t,e=0},this.getState=function(){return i},this.init(),this},Gibberish.ADSR.prototype=Gibberish._envelope,Gibberish.analysis=function(){this.type="analysis",this.codegen=function(){return Gibberish.memo[this.symbol]?Gibberish.memo[this.symbol]:(v=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=v,this.variable=v,Gibberish.upvalues.push("var "+this.symbol+" = Gibberish.functions."+this.symbol+";\n"),this.codeblock="var "+this.variable+" = "+this.symbol+"();\n",this.variable)},this.codegen2=function(){for(var o in this.properties){var e=this.properties[o];if(Array.isArray(e.value))for(var t=0;e.value.length>t;t++){var i=e.value[t];"object"==typeof i&&(i.type="ddd",i.codegen(),i.getCodeblock(),i.type="analysis")}else if("object"==typeof e.value&&!Gibberish.memo[e.value.symbol]){e.value.type="ddd",e.value.codegen(),e.value.getCodeblock(),Gibberish.codeblock.push(e.value.codeblock),e.value.type="analysis";var n=e.value.variable?e.value.variable:Gibberish.generateSymbol("v");Gibberish.memo[e.value.symbol]=n,e.value.variable=n,Gibberish.codestring="var "+e.value.symbol+" = Gibberish.functions."+e.value.symbol+";\n"+Gibberish.codestring}if(e.binops)for(var r=0;e.binops.length>r;r++){var s=e.binops[r];"object"==typeof s.ugen&&s.ugen.codegen()}}},this.analysisCodegen=function(){var e=this.analysisSymbol+"("+this.input.variable+",";for(var i in this.properties)"input"!==i&&(e+=this[i]+",");return e=e.slice(0,-1),e+=");",this.analysisCodeblock=e,e},this.analysisInit=function(){this.analysisSymbol=Gibberish.generateSymbol(this.name),Gibberish.functions[this.analysisSymbol]=this.analysisCallback,Gibberish.upvalues.push("var "+this.analysisSymbol+" = Gibberish.functions."+this.analysisSymbol+";\n"),Gibberish.analysisUgens.push(this)}},Gibberish.analysis.prototype=new Gibberish.ugen,Gibberish._analysis=new Gibberish.analysis,Gibberish.Follow=function(){this.name="follow",this.properties={mult:1,input:0,bufferSize:4410};var r=Math.abs,i=[0],t=0,e=0,n=0;this.analysisCallback=function(s,o,a){t+=r(s),t-=i[e],i[e]=r(s),e=(e+1)%o,i[e]=i[e]?i[e]:0,n=t/o*a},this.callback=function(){return n},this.init()},Gibberish.Follow.prototype=Gibberish._analysis,Gibberish.SingleSampleDelay=function(){this.name="single_sample_delay",this.properties={input:arguments[0]||0,amp:arguments[1]||1};var e=0;this.analysisCallback=function(i,t){e="object"==typeof i?"object"==typeof i?[i[0]*t,i[1]*t]:i*t:i*t},this.callback=function(){return e},this.init(),this.analysisInit()},Gibberish.SingleSampleDelay.prototype=Gibberish._analysis,Gibberish.Record=function(n,t,s){var r=new Float32Array(t),e=0,i=!1,o=this;Gibberish.extend(this,{name:"record",oncomplete:s,properties:{input:0,size:t||0},analysisCallback:function(t,n){i&&(r[e++]="object"==typeof t?t[0]+t[1]:t,e>=n&&(i=!1,o.remove()))},record:function(){return e=0,i=!0,this},getBuffer:function(){return r},getPhase:function(){return e},remove:function(){this.oncomplete!==void 0&&this.oncomplete();for(var e=0;Gibberish.analysisUgens.length>e;e++){var i=Gibberish.analysisUgens[e];if(i===this)return Gibberish.analysisUgens.splice(e,1),void 0}}}),this.properties.input=n,this.init(),this.analysisInit(),Gibberish.dirty()},Gibberish.Record.prototype=Gibberish._analysis,Gibberish.effect=function(){this.type="effect"},Gibberish.effect.prototype=new Gibberish.ugen,Gibberish._effect=new Gibberish.effect,Gibberish.Distortion=function(){var e=Math.abs,i=Math.log,t=Math.LN2;Gibberish.extend(this,{name:"distortion",properties:{input:0,amount:50},callback:function(n,s){var r;return"number"==typeof n?(r=n*s,n=r/(1+e(r))/(i(s)/t)):(r=n[0]*s,n[0]=r/(1+e(r))/(i(s)/t),r=n[1]*s,n[1]=r/(1+e(r))/(i(s)/t)),n}}).init().processProperties(arguments)},Gibberish.Distortion.prototype=Gibberish._effect,Gibberish.Delay=function(){var e=[],i=0;e.push(new Float32Array(88200)),e.push(new Float32Array(88200)),Gibberish.extend(this,{name:"Delay",properties:{input:0,time:22050,feedback:.5,channels:1},callback:function(t,o,n){var a="number"==typeof t?1:2,r=i++%88200,s=(r+o)%88200;return 1===a?(e[0][s]=(t+e[0][r])*n,t+=e[0][r]):(e[0][s]=(t[0]+e[0][r])*n,t[0]+=e[0][r],e[1][s]=(t[1]+e[1][r])*n,t[1]+=e[1][r]),t}}).init().processProperties(arguments)},Gibberish.Delay.prototype=Gibberish._effect,Gibberish.Decimator=function(){var e=0,i=[],r=Math.pow,t=Math.floor;Gibberish.extend(this,{name:"Decimator",properties:{input:0,bitDepth:16,sampleRate:1},callback:function(n,o,a){e+=a;var h="number"==typeof n?1:2;if(1===h){if(e>=1){var s=r(o,2);i[0]=t(n*s)/s,e-=1}n=i[0]}else{if(e>=1){var s=r(o,2);i[0]=t(n[0]*s)/s,i[1]=t(n[1]*s)/s,e-=1}n=i}return n}}).init().processProperties(arguments)},Gibberish.Decimator.prototype=Gibberish._effect,Gibberish.RingModulation=function(){var i=(new Gibberish.Sine).callback,e=[0,0];Gibberish.extend(this,{name:"ringmod",properties:{input:0,frequency:440,amp:.5,mix:.5},callback:function(r,h,b,n){var o="number"==typeof r?1:2,t=1===o?r:r[0],a=i(h,b);if(t=t*(1-n)+t*a*n,2===o){var s=r[1];return s=s*(1-n)+s*a*n,e[0]=t,e[1]=s,e}return t}}).init().processProperties(arguments)},Gibberish.RingModulation.prototype=Gibberish._effect,Gibberish.OnePole=function(){var e=0;Gibberish.extend(this,{name:"onepole",type:"effect",properties:{input:null,a0:.15,b1:.85},callback:function(t,r,n){var i=t*r+e*n;return e=i,i},smooth:function(e,i){this.input=i.properties[e],i.mod(e,this,"=")}}).init().processProperties(arguments)},Gibberish.OnePole.prototype=Gibberish._effect,Gibberish.Filter24=function(){var e=[0,0,0,0],i=[0,0,0,0],t=[0,0],r=isNaN(arguments[0])?.1:arguments[0],n=isNaN(arguments[1])?3:arguments[1];_isLowPass=arguments[2]!==void 0?arguments[2]:!0,Gibberish.extend(this,{name:"filter24",properties:{input:0,cutoff:r,resonance:n,isLowPass:_isLowPass},callback:function(o,r,h,b){var l="number"==typeof o?1:2,s=1===l?o:o[0],n=e[3]*h;if(n=n>1?1:n,r=0>r?0:r,r=r>1?1:r,s-=n,e[0]=e[0]+(-e[0]+s)*r,e[1]=e[1]+(-e[1]+e[0])*r,e[2]=e[2]+(-e[2]+e[1])*r,e[3]=e[3]+(-e[3]+e[2])*r,s=b?e[3]:s-e[3],2===l){var a=o[1];return n=i[3]*h,n=n>1?1:n,a-=n,i[0]=i[0]+(-i[0]+a)*r,i[1]=i[1]+(-i[1]+i[0])*r,i[2]=i[2]+(-i[2]+i[1])*r,i[3]=i[3]+(-i[3]+i[2])*r,a=b?i[3]:a-i[3],t[0]=s,t[1]=s,t}return s}}).init().processProperties(arguments)},Gibberish.Filter24.prototype=Gibberish._effect,Gibberish.SVF=function(){var e=[0,0],i=[0,0],r=Math.PI,t=[0,0];Gibberish.extend(this,{name:"SVF",properties:{input:0,cutoff:440,Q:2,mode:0},callback:function(u,d,l,s){var p="number"==typeof u?1:2,b=1===p?u:u[0],a=2*r*d/44100;l=1/l;var n=i[0]+a*e[0],o=b-n-l*e[0],h=a*o+e[0],f=o+n;if(e[0]=h,i[0]=n,b=0===s?n:1===s?o:2===s?h:f,2===p){var c=u[1],n=i[1]+a*e[1],o=c-n-l*e[1],h=a*o+e[1],f=o+n;e[1]=h,i[1]=n,c=0===s?n:1===s?o:2===s?h:f,t[0]=b,t[1]=c}else t=b;return t}}).init().processProperties(arguments)},Gibberish.SVF.prototype=Gibberish._effect,Gibberish.Biquad=function(){var e=[0,0],t=[0,0],i=[0,0],r=[0,0],n=[0,0];Gibberish.extend(this,{name:"biquad",mode:"LP",cutoff:2e3,Q:.5,properties:{input:null,b0:.001639,b1:.003278,b2:.001639,a1:-1.955777,a2:.960601},calculateCoefficients:function(){switch(this.mode){case"LP":var i=2*Math.PI*this.cutoff/44100,n=Math.sin(i),t=Math.cos(i),e=n/(2*this.Q),s=(1-t)/2,l=1-t,a=s,r=1+e,h=-2*t,b=1-e;break;case"HP":var i=2*Math.PI*this.cutoff/44100,n=Math.sin(i),t=Math.cos(i),e=n/(2*this.Q),s=(1+t)/2,l=-(1+t),a=s,r=1+e,h=-2*t,b=1-e;break;case"BP":var i=2*Math.PI*this.cutoff/44100,n=Math.sin(i),t=Math.cos(i),o=Math.log(2)/2*this.Q*i/n,e=n*(Math.exp(o)-Math.exp(-o))/2,s=e,l=0,a=-e,r=1+e,h=-2*t,b=1-e;break;default:return}this.b0=s/r,this.b1=l/r,this.b2=a/r,this.a1=h/r,this.a2=b/r},call:function(e){return this.function(e,this.b0,this.b1,this.b2,this.a1,this.a2)},callback:function(s,b,l,u,c,p){var a="number"==typeof s?1:2,o=0,h=0,f=1===a?s:s[0];return o=b*f+l*e[0]+u*t[0]-c*i[0]-p*r[0],t[0]=e[0],e[0]=s[0],r[0]=i[0],i[0]=o,2===a&&(inR=s[1],h=b*inR+l*e[1]+u*t[1]-c*i[1]-p*r[1],t[1]=e[1],e[1]=s[1],r[1]=i[1],i[1]=h,n[0]=o,n[1]=h),1===a?o:n}}).init().processProperties(arguments),this.calculateCoefficients()},Gibberish.Biquad.prototype=Gibberish._effect,Gibberish.Flanger=function(){var i=[new Float32Array(88200),new Float32Array(88200)],e=88200,s=(new Gibberish.Sine).callback,n=Gibberish.interpolate,t=-100,r=0;Gibberish.extend(this,{name:"flanger",properties:{input:0,rate:.25,amount:125,feedback:0,offset:125},callback:function(o,u,c,b,p,l){var l="number"==typeof o?1:2,h=t+s(u,.95*c);h>e?h-=e:0>h&&(h+=e);var a=n(i[0],h);return i[0][r]=1===l?o+a*b:o[0]+a*b,2===l?(o[0]+=a,a=n(i[1],h),i[1][r]=o[1]+a*b,o[1]+=a):o+=a,++r>=e&&(r=0),++t>=e&&(t=0),o}}).init().processProperties(arguments),t=-1*this.offset},Gibberish.Flanger.prototype=Gibberish._effect,Gibberish.Vibrato=function(){var i=[new Float32Array(88200),new Float32Array(88200)],e=88200,s=(new Gibberish.Sine).callback,n=Gibberish.interpolate,t=-100,r=0;Gibberish.extend(this,{name:"vibrato",properties:{input:0,rate:5,amount:.5,offset:125},callback:function(o,l,u,c,b){var b="number"==typeof o?1:2,a=t+s(l,u*c-1);a>e?a-=e:0>a&&(a+=e);var h=n(i[0],a);return i[0][r]=1===b?o:o[0],2===b?(o[0]=h,h=n(i[1],a),i[1][r]=o[1],o[1]=h):o=h,++r>=e&&(r=0),++t>=e&&(t=0),o}}).init().processProperties(arguments),t=-1*this.offset},Gibberish.Vibrato.prototype=Gibberish._effect,Gibberish.BufferShuffler=function(){var t=[new Float32Array(88200),new Float32Array(88200)],o=88200,i=0,r=0,d=0,f=0,n=0,c=Math.random,e=1,b=!1,l=!1,u=!1,a=Gibberish.interpolate,p=!1,h=1,s=!1,v=Gibberish.rndf,m=[0,0];Gibberish.extend(this,{name:"buffer_shuffler",properties:{input:0,chance:.25,rate:11025,length:22050,reverseChange:.5,pitchChance:.5,pitchMin:.25,pitchMax:2,wet:1,dry:0},callback:function(y,F,L,A,D,I,C,M,x,S){var G="number"==typeof y?1:2;n?0===++f%(A-400)&&(b=!1,l=!0,e=1,f=0):(t[0][r]=1===G?y:y[0],t[1][r]=1===G?y:y[1],r++,r%=o,s=0===r?1:s,d++,0==d%L&&F>c()&&(u=D>c(),n=!0,u||(i=r-A,0>i&&(i=o+i)),p=I>c(),p&&(h=v(C,M)),e=1,b=!0,l=!1)),i+=u?-1*h:h,0>i?i+=o:i>o&&(i-=o);var k,P,g,_,w=a(t[0],i);return b?(e-=.0025,g=w*(1-e),k=1===G?g+y*e:g+y[0]*e,2===G&&(_=a(t[1],i),g=_*(1-e),P=1===G?k:g+y[1]*e),.0025>=e&&(b=!1)):l?(e-=.0025,g=w*e,k=1===G?g+y*e:g+y[0]*(1-e),2===G&&(_=a(t[1],i),g=_*e,P=g+y[1]*(1-e)),.0025>=e&&(l=!1,n=!1,u=!1,h=1,p=0)):1===G?k=n&&s?w*x+y*S:y:(_=a(t[1],i),k=n&&s?w*x+y[0]*S:y[0],P=n&&s?_*x+y[1]*S:y[1]),m=[k,P],1===G?k:m}}).init().processProperties(arguments)},Gibberish.BufferShuffler.prototype=Gibberish._effect,Gibberish.AllPass=function(t){var e=-1,i=new Float32Array(t||500),r=i.length;Gibberish.extend(this,{name:"allpass",properties:{input:0},callback:function(t){e=++e%r;var n=i[e],s=-1*t+n;return i[e]=t+.5*n,s}})},Gibberish.Comb=function(t){var e=new Float32Array(t||1200),r=e.length,n=0,i=0;Gibberish.extend(this,{name:"comb",properties:{input:0,time:t||1200},callback:function(o){var t=++n%r,s=e[t];return i=.8*s+.2*i,e[t]=o+.84*i,s}})},Gibberish.Reverb=function(){var i={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.9,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},r=[],n=[],t=[0,0];Gibberish.extend(this,{name:"Reverb",roomSize:.5,damping:.2223,properties:{input:0,wet:.5,dry:.55},callback:function(i,h,b){for(var l="object"==typeof i?2:1,o=1===l?i:i[0]+i[1],a=.015*o,s=a,e=0;8>e;e++){var u=r[e](a);s+=u}for(var e=0;4>e;e++)s=n[e](s);return t[0]=t[1]=o*b+s*h,t}}).init().processProperties(arguments);for(var e=0;8>e;e++)r.push(new Gibberish.Comb(i.combTuning[e],this.roomSize*i.scaleRoom*i.offsetRoom,this.damping).callback);for(var e=0;4>e;e++)n.push(new Gibberish.AllPass(i.allPassTuning[e],i.allPassFeedback).callback)},Gibberish.Reverb.prototype=Gibberish._effect,Gibberish.Granulator=function(t){var i=[];buffer=null,interpolate=Gibberish.interpolate,panner=Gibberish.makePanner(),bufferLength=0,debug=0,write=0,self=this,out=[0,0],_out=[0,0],rndf=Gibberish.rndf,numberOfGrains=t.numberOfGrains||20,Gibberish.extend(this,{name:"granulator",bufferLength:88200,reverse:!0,spread:.5,properties:{speed:1,speedMin:0,speedMax:0,grainSize:1e3,position:.5,positionMin:0,positionMax:0,amp:.2,fade:.1,pan:0,shouldWrite:!1},callback:function(u,h,l,n,c,o,a,f,b,p){for(var s=0;numberOfGrains>s;s++){var e=i[s];if(e._speed>0){e.pos>e.end&&(e.pos=(a+rndf(c,o))*buffer.length,e.start=e.pos,e.end=e.start+n,e._speed=u+rndf(h,l),e._speed=.1>e._speed?.1:e._speed,e._speed=.1>e._speed&&e._speed>0?.1:e._speed,e._speed=e._speed>-.1&&0>e._speed?-.1:e._speed,e.fadeAmount=e._speed*b*n,e.pan=rndf(-1*self.spread,self.spread));for(var t=e.pos;t>buffer.length;)t-=buffer.length;for(;0>t;)t+=buffer.length;var r=interpolate(buffer,t);r*=e.pos<e.fadeAmount+e.start?(e.pos-e.start)/e.fadeAmount:1,r*=e.pos>e.end-e.fadeAmount?(e.end-e.pos)/e.fadeAmount:1}else{e.pos<e.end&&(e.pos=(a+rndf(c,o))*buffer.length,e.start=e.pos,e.end=e.start-n,e._speed=u+rndf(h,l),e._speed=.1>e._speed&&e._speed>0?.1:e._speed,e._speed=e._speed>-.1&&0>e._speed?-.1:e._speed,e.fadeAmount=e._speed*b*n);for(var t=e.pos;t>buffer.length;)t-=buffer.length;for(;0>t;)t+=buffer.length;var r=interpolate(buffer,t);r*=e.pos>e.start-e.fadeAmount?(e.start-e.pos)/e.fadeAmount:1,r*=e.pos<e.end+e.fadeAmount?(e.end-e.pos)/e.fadeAmount:1}_out=panner(r*f,e.pan,_out),out[0]+=_out[0],out[1]+=_out[1],e.pos+=e._speed}return panner(out,p,out)
}}).init().processProperties(arguments);for(var e=0;numberOfGrains>e;e++)i[e]={pos:self.position+Gibberish.rndf(self.positionMin,self.positionMax),_speed:self.speed+Gibberish.rndf(self.speedMin,self.speedMax)},i[e].start=i[e].pos,i[e].end=i[e].pos+self.grainSize,i[e].fadeAmount=i[e]._speed*self.fade*self.grainSize,i[e].pan=Gibberish.rndf(-1*self.spread,self.spread);t.input!==void 0?(that.shouldWrite=!0,that.sampler=new Gibberish.Sampler,that.sampler.connect(),that.sampler.record(t.buffer,that.bufferLength),that.buffer=that.sampler.buffer):t.buffer!==void 0&&(buffer=t.buffer,bufferLength=buffer.length)},Gibberish.Granulator.prototype=Gibberish._effect,Gibberish.synth=function(){this.type="oscillator",this.oscillatorInit=function(){this.fx=new Array2,this.fx.parent=this}},Gibberish.synth.prototype=new Gibberish.ugen,Gibberish._synth=new Gibberish.synth,Gibberish.Synth=function(){this.name="synth",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,glide:.15,amp:.25,channels:2,pan:0},this.note=function(e,i){this.frequency=e,_frequency=e,i!==void 0&&(this.amp=i),t.run()};var t=new Gibberish.AD,s=t.getState,o=t.callback,i=new Gibberish.PWM,r=i.callback,a=(new Gibberish.OnePole).callback,n=Gibberish.makePanner(),e=[0,0];this.callback=function(h,u,c,p,t,f,b,l){if(t=t>=1?.99999:t,h=a(h,1-t,t),2>s()){var d=o(c,p),i=r(h,1,u)*d*f;return e[0]=e[1]=i,1===b?i:n(i,l,e)}return i=e[0]=e[1]=0,1===b?i:n(i,l,e)},this.getOsc=function(){return i},this.setOsc=function(e){i=e,r=i.callback};var h="PWM";Object.defineProperty(this,"waveform",{get:function(){return h},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth.prototype=Gibberish._synth,Gibberish.PolySynth=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth",maxVoices:5,voiceCount:0,polyProperties:{glide:0,attack:22050,decay:22050,pulsewidth:.5,waveform:"PWM"},note:function(e,i){var t=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),t.note(e,i)}}),this.amp=1/this.maxVoices,this.processProperties(arguments),this.children=[],this.dirty=!0;for(var e=0;this.maxVoices>e;e++){var t={attack:this.attack,decay:this.decay,pulsewidth:this.pulsewidth,channels:2,amp:1},i=new Gibberish.Synth(t);i.connect(this),this.children.push(i)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Synth2=function(){this.name="synth2",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,cutoff:.25,resonance:3.5,useLowPassFilter:!0,glide:.15,amp:.25,channels:1,pan:0},this.note=function(e,i){this.frequency=e,_frequency=e,i!==void 0&&(this.amp=i),t.run()};var t=new Gibberish.AD,s=t.getState,b=t.callback,i=new Gibberish.PWM,r=i.callback,l=new Gibberish.Filter24,o=l.callback,a=(new Gibberish.OnePole).callback,n=Gibberish.makePanner(),e=[0,0];this.callback=function(h,m,v,p,f,d,g,t,y,l,u){if(2>s()){t=t>=1?.99999:t,h=a(h,1-t,t);var c=b(v,p),i=o(r(h,.15,m),f*c,d,g)*c*y;return e[0]=e[1]=i,1===l?i:n(i,u,e)}return i=e[0]=e[1]=0,1===l?i:n(i,u,e)},this.getOsc=function(){return i},this.setOsc=function(e){i=e,r=i.callback};var h="PWM";Object.defineProperty(this,"waveform",{get:function(){return h},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth2.prototype=Gibberish._synth,Gibberish.FMSynth=function(){this.name="fmSynth",this.properties={frequency:0,cmRatio:2,index:5,attack:22050,decay:22050,glide:.15,amp:.25,channels:2,pan:0},this.note=function(e,t){this.frequency=e,_frequency=e,t!==void 0&&(this.amp=t),i.run()};var i=new Gibberish.AD,r=i.getState,n=i.callback,s=(new Gibberish.Sine).callback,o=(new Gibberish.Sine).callback,a=(new Gibberish.OnePole).callback,t=Gibberish.makePanner(),e=[0,0];this.callback=function(h,m,p,f,d,b,y,l,u){if(2>r()){b>=1&&(b=.9999),h=a(h,1-b,b);var c=n(f,d),v=o(h*m,h*p,1,1)*c,i=s(h+v,1,1)*c*y;return e[0]=e[1]=i,1===l?i:t(i,u,e)}return i=e[0]=e[1]=0,1===l?i:t(i,u,e)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.FMSynth.prototype=Gibberish._synth,Gibberish.PolyFM=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polyfm",maxVoices:5,voiceCount:0,children:[],polyProperties:{glide:0,attack:22050,decay:22050,index:5,cmRatio:2},note:function(e,i){var t=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),t.note(e,i)}}),this.amp=1/this.maxVoices,this.processProperties(arguments);for(var e=0;this.maxVoices>e;e++){var t={attack:this.attack,decay:this.decay,cmRatio:this.cmRatio,index:this.index,channels:2,amp:1},i=new Gibberish.FMSynth(t);i.connect(this),this.children.push(i)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},AudioFileRequest.prototype.onSuccess=function(){},AudioFileRequest.prototype.onFailure=function(){},AudioFileRequest.prototype.send=function(){if("wav"!=this.extension&&"aiff"!=this.extension&&"aif"!=this.extension)return this.onFailure(),void 0;var e=new XMLHttpRequest;e.open("GET",this.url,this.async),e.overrideMimeType("text/plain; charset=x-user-defined"),e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0==e.status?this.handleResponse(e.responseText):this.onFailure())}.bind(this),e.send(null)},AudioFileRequest.prototype.handleResponse=function(t){var e,i;"wav"==this.extension?(e=new WAVDecoder,i=e.decode(t)):("aiff"==this.extension||"aif"==this.extension)&&(e=new AIFFDecoder,i=e.decode(t)),this.onSuccess(i)},Decoder.prototype.readString=function(i,e,t){return i.slice(e,e+t)},Decoder.prototype.readIntL=function(t,r,n){for(var i=0,e=0;n>e;e++)i+=(255&t.charCodeAt(r+e))*Math.pow(2,8*e);return i},Decoder.prototype.readChunkHeaderL=function(i,t){var e={};return e.name=this.readString(i,t,4),e.length=this.readIntL(i,t+4,4),e},Decoder.prototype.readIntB=function(r,n,i){for(var t=0,e=0;i>e;e++)t+=(255&r.charCodeAt(n+e))*Math.pow(2,8*(i-e-1));return t},Decoder.prototype.readChunkHeaderB=function(i,t){var e={};return e.name=this.readString(i,t,4),e.length=this.readIntB(i,t+4,4),e},Decoder.prototype.readFloatB=function(t,r){var e=this.readIntB(t,r,2),n=32768;e>=n&&(e|=~(n-1));var s=1;0>e&&(s=-1,e+=n);var i,o=this.readIntB(t,r+2,4),a=this.readIntB(t,r+6,4);return 0==(e==o==a)?i=0:32767==e?i=Number.MAX_VALUE:(e-=16383,i=(4294967296*o+a)*Math.pow(2,e-63)),s*i},WAVDecoder.prototype.__proto__=Decoder.prototype,WAVDecoder.prototype.decode=function(i){var n={},e=0,t=this.readChunkHeaderL(i,e);if(e+=8,"RIFF"!=t.name)return console.error("File is not a WAV"),null;var f=t.length;f+=8;var y=this.readString(i,e,4);if(e+=4,"WAVE"!=y)return console.error("File is not a WAV"),null;for(;f>e;){var t=this.readChunkHeaderL(i,e);if(e+=8,"fmt "==t.name){var m=this.readIntL(i,e,2);if(e+=2,1!=m)return console.error("Cannot decode non-PCM encoded WAV file"),null;var o=this.readIntL(i,e,2);e+=2;var d=this.readIntL(i,e,4);e+=4,e+=4,e+=2;var c=this.readIntL(i,e,2),l=c/8;e+=2}else if("data"==t.name){for(var u=t.length/(l*o),h=[],r=0;o>r;r++)h.push(new Float32Array(u));for(var r=0;o>r;r++)for(var v=h[r],s=0;u>s;s++){var p=e;p+=(s*o+r)*l;var b=this.readIntL(i,p,l),a=1<<c-1;b>=a&&(b|=~(a-1)),v[s]=b/a}e+=t.length}else e+=t.length}return n.sampleRate=d,n.bitDepth=c,n.channels=h,n.length=u,n},AIFFDecoder.prototype.__proto__=Decoder.prototype,AIFFDecoder.prototype.decode=function(i){var n={},e=0,r=this.readChunkHeaderB(i,e);if(e+=8,"FORM"!=r.name)return console.error("File is not an AIFF"),null;var f=r.length;f+=8;var y=this.readString(i,e,4);if(e+=4,"AIFF"!=y)return console.error("File is not an AIFF"),null;for(;f>e;){var r=this.readChunkHeaderB(i,e);if(e+=8,"COMM"==r.name){var a=this.readIntB(i,e,2);e+=2;var h=this.readIntB(i,e,4);e+=4;for(var b=[],t=0;a>t;t++)b.push(new Float32Array(h));var l=this.readIntB(i,e,2),d=l/8;e+=2;var v=this.readFloatB(i,e);e+=10}else if("SSND"==r.name){var p=this.readIntB(i,e,4);e+=4,e+=4,e+=p;for(var t=0;a>t;t++)for(var m=b[t],s=0;h>s;s++){var c=e;c+=(s*a+t)*d;var u=this.readIntB(i,c,d),o=1<<l-1;u>=o&&(u|=~(o-1)),m[s]=u/o}e+=r.length-p-8}else e+=r.length}return n.sampleRate=v,n.bitDepth=l,n.channels=b,n.length=h,n},Gibberish.Sampler=function(){var e=1,s=Gibberish.interpolate,a=Gibberish.makePanner(),n=[0,0],i=null,r=1,t=this;if(Gibberish.extend(this,{name:"sampler",file:null,isLoaded:!1,playOnLoad:0,properties:{pitch:1,amp:1,isRecording:!1,isPlaying:!0,input:0,length:0,start:0,end:1,loops:0,pan:0},_onload:function(n){i=n.channels[0],r=n.length,t.end=r,t.length=e=r,console.log("LOADED ",t.file,r),Gibberish.audioFiles[t.file]=i,t.onload&&t.onload(),0!==t.playOnLoad&&t.note(t.playOnLoad),t.isLoaded=!0},note:function(i,t){"number"==typeof t&&(this.amp=t),this.pitch=i,null!==this.function&&(this.isPlaying=!0,e=i>0?this.start:this.end)},record:function(n,s){this.isRecording=!0;var t=this;new Gibberish.Record(n,s,function(){i=this.getBuffer(),t.end=r=i.length,e=t.end,t.isRecording=!1}).record()},getBuffer:function(){return i},callback:function(t,f,c,b,p,d,l,o,h,u){var r=0;return e+=t,o>e&&e>0?(t>0?r=null!==i&&b?s(i,e):0:e>l?r=null!==i&&b?s(i,e):0:e=h?o:e,a(r,u,n)):(e=h&&t>0?l:e,e=h&&0>t?o:e,n[0]=n[1]=r,n)}}).init().oscillatorInit().processProperties(arguments),arguments[0]!==void 0&&("string"==typeof arguments[0]?(console.log("SETTING FILE"),this.file=arguments[0],delete arguments[0]):"object"==typeof arguments[0]&&arguments[0].file&&(this.file=arguments[0].file)),console.log(this),Gibberish.audioFiles[this.file]!==void 0)i=Gibberish.audioFiles[this.file],this.end=this.bufferLength=i.length,e=this.bufferLength,Gibberish.dirty(this),this.onload&&this.onload();else if(null!==this.file){var o=new AudioFileRequest(this.file);o.onSuccess=this._onload,o.send()}else this.buffer!==void 0&&(this.isLoaded=!0,i=this.buffer,this.end=this.bufferLength=i.length,e=this.bufferLength,arguments[0]&&arguments[0].loops&&(this.loops=1),Gibberish.dirty(this),this.onload&&this.onload())},Gibberish.Sampler.prototype=Gibberish._oscillator,Gibberish.MonoSynth=function(){Gibberish.extend(this,{name:"monosynth",properties:{frequency:0,amp1:1,amp2:1,amp3:1,attack:1e4,decay:1e4,cutoff:.2,resonance:2.5,filterMult:.3,isLowPass:!0,amp:.6,detune2:.01,detune3:-.01,octave2:1,octave3:-1,glide:0,pan:0,channels:1},waveform:"Saw",note:function(e){this.frequency=e,r()>0&&t.run()}});var i=this.waveform;Object.defineProperty(this,"waveform",{get:function(){return i},set:function(e){i!==e&&(i=e,o=(new Gibberish[e]).callback,n=(new Gibberish[e]).callback,s=(new Gibberish[e]).callback)}});var t=new Gibberish.AD(this.attack,this.decay),r=t.getState,a=t.callback,h=(new Gibberish.Filter24).callback,o=new Gibberish[this.waveform](this.frequency,this.amp1).callback,n=new Gibberish[this.waveform](this.frequency2,this.amp2).callback,s=new Gibberish[this.waveform](this.frequency3,this.amp3).callback,b=(new Gibberish.OnePole).callback,l=Gibberish.makePanner(),e=[0,0];this.callback=function(i,k,F,M,A,P,w,_,G,I,S,v,y,d,f,p,D,x){if(2>r()){p>=1&&(p=.9999),i=b(i,1-p,p);var c=i;if(d>0)for(var t=0;d>t;t++)c*=2;else if(0>d)for(var t=0;t>d;t--)c/=2;var u=i;if(f>0)for(var t=0;f>t;t++)u*=2;else if(0>f)for(var t=0;t>f;t--)u/=2;c+=v>0?(2*i-i)*v:(i-i/2)*v,u+=y>0?(2*i-i)*y:(i-i/2)*y;var C=o(i,k,1)+n(c,F,1)+s(u,M,1),g=a(A,P),m=h(C,w+G*g,_,I,1)*g;return m*=S,e[0]=e[1]=m,1===x?e:l(m,D,e)}return e[0]=e[1]=0,e},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.MonoSynth.prototype=Gibberish._synth;
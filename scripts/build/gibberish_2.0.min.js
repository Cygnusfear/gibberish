function AudioFileRequest(e,i){this.url=e,(i===void 0||null==i)&&(i=!0),this.async=i;var t=e.split(".");this.extension=t[t.length-1].toLowerCase()}function Decoder(){}function WAVDecoder(){}function AIFFDecoder(){}Gibberish={memo:{},functions:{},upvalues:[],codeblock:[],analysisCodeblock:[],analysisUgens:[],dirtied:[],id:0,isDirty:!1,out:null,debug:!1,callback:"",audioFiles:{},createCallback:function(){this.memo={},this.codeblock.length=0;for(var i=0;this.dirtied.length>i;i++)this.dirtied[i].codegen();if(this.dirtied.length=0,this.codestring=this.upvalues.join(""),this.codestring+="\nGibberish.callback = function() {\n	",this.memo={},this.out.getCodeblock(),this.codestring+=this.codeblock.join("	"),this.codestring+="\n	",this.codeblock.length=0,this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var i=0;this.analysisUgens.length>i;i++)this.codeblock.length=0,this.analysisUgens[i].codegen2(),this.codestring+=this.codeblock.join(""),this.codestring+="\n	",this.analysisCodeblock.push(this.analysisUgens[i].analysisCodegen());this.codestring+=this.analysisCodeblock.join("\n	"),this.codestring+="\n\n	"}this.codestring+="return "+this.out.variable+";\n",this.codestring+="}",this.callbackString=this.codestring,this.debug&&console.log(this.callbackString),eval(this.codestring)},audioProcess:function(e){for(var i=e.outputBuffer.getChannelData(0),t=e.outputBuffer.getChannelData(1),r=Gibberish,n=0,s=e.outputBuffer.length;s>n;n++){r.isDirty&&(r.createCallback(),r.isDirty=!1);var o=r.callback();i[n]=o[0],t[n]=o[1]}},audioProcess2:function(e){for(var i=Gibberish,t=0,r=e.length;r>t;t+=2){i.isDirty&&(i.createCallback(),i.isDirty=!1);var n=i.callback();e[t]=n[0],e[t+1]=n[1]}},clear:function(){this.upvalues.length=1,this.out.inputs.length=0,this.analysisUgens.length=0,Gibberish.dirty(this.out)},dirty:function(e){if(e!==void 0){for(var i=!1,t=0;this.dirtied.length>t;t++)this.dirtied[t].variable===e.variable&&(i=!0);i||(this.isDirty=!0,this.dirtied.push(e))}else this.isDirty=!0},generateSymbol:function(e){return e+"_"+this.id++},AudioDataDestination:function(e,i){var t=new Audio;t.mozSetup(2,e);var r,n=0,s=e/2,o=null;setInterval(function(){var e;if(o){if(e=t.mozWriteAudio(o.subarray(r)),n+=e,r+=e,o.length>r)return;o=null}var a=t.mozCurrentSampleOffset(),h=a+s-n;if(h>0){var b=new Float32Array(h);i(b),e=t.mozWriteAudio(b),a=t.mozCurrentSampleOffset(),b.length>e&&(o=b,r=e),n+=e}},100)},init:function(){Gibberish.out=new Gibberish.Bus2,Gibberish.dirty(Gibberish.out);var e=arguments[0]===void 0?1024:arguments[0];return start=function(){if(-1===navigator.userAgent.indexOf("Firefox")){if(document.getElementsByTagName("body")[0].removeEventListener("touchstart",start),Gibberish.context=new webkitAudioContext,Gibberish.node=Gibberish.context.createJavaScriptNode(e,2,2,44100),Gibberish.node.onaudioprocess=Gibberish.audioProcess,Gibberish.node.connect(Gibberish.context.destination),"ontouchstart"in document.documentElement){var i=Gibberish.context.createBufferSource();i.connect(Gibberish.context.destination),i.noteOn(0)}}else Gibberish.AudioDataDestination(44100,Gibberish.audioProcess2)},"ontouchstart"in document.documentElement?document.getElementsByTagName("body")[0].addEventListener("touchstart",start):start(),this},makePanner:function(){var e=Math.sin,i=Math.cos,t=Math.sqrt(2)/2,r=function(r,n,s){var o="object"==typeof r,a=o?r[0]:r,h=o?r[1]:r;return s[0]=a*t*(i(n)-e(n)),s[1]=h*t*(i(n)+e(n)),s};return r},polyInit:function(e){e.mod=e.polyMod,e.removeMod=e.removePolyMod;for(var i in e.polyProperties)(function(i){var t=e.polyProperties[i];Object.defineProperty(e,i,{get:function(){return t},set:function(r){t=r;for(var n=0;e.children.length>n;n++)e.children[n][i]=t}})})(i)},interpolate:function(){var e=Math.floor;return function(i,t){var r=e(t),n=r+1,s=t-r;return n=i.length>n?n:0,i[r]*(1-s)+i[n]*s}}(),ugen:function(){Gibberish.extend(this,{processProperties:function(){if("object"!=typeof arguments[0][0]||arguments[0][0].type!==void 0||Array.isArray(arguments[0][0])){var e=0;for(var i in this.properties)"object"==typeof this.properties[i]&&this.properties[i].binops!==void 0?arguments[0][e]!==void 0&&(this.properties[i].value=arguments[0][e++]):arguments[0][e]!==void 0&&(this.properties[i]=arguments[0][e++])}else{var t=arguments[0][0];for(var i in t)t[i]!==void 0&&("object"==typeof this.properties[i]&&this.properties[i].binops!==void 0?this.properties[i].value=t[i]:this[i]=t[i])}return this},codegen:function(){var e="",i=null;if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];i=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=i,this.variable=i,e+="var "+i+" = "+this.symbol+"(";for(var t in this.properties){var r=this.properties[t],n="";if("single_sample_delay"===this.name&&console.log("SSD PROP"+t),Array.isArray(r.value)){0===r.value.length&&(n=0);for(var s=0;r.value.length>s;s++){var o=r.value[s];n+="object"==typeof o?null!==o?o.codegen():"null":o,n+=r.value.length-1>s?", ":""}}else n="object"==typeof r.value?null!==r.value?r.value.codegen():"null":r.value;if(e+=n,r.binops)for(var a=0;r.binops.length>a;a++){var h,b=r.binops[a];h="number"==typeof b.ugen?b.ugen:null!==b.ugen?b.ugen.codegen():"null","="===b.binop?(e=e.replace(n,""),e+=h):"++"===b.binop?(Gibberish.upvalues.push("var abs = Math.abs\n;"),e+=" + abs("+h+")"):e+=" "+b.binop+" "+h}e+=", "}return" "===e.charAt(e.length-1)&&(e=e.slice(0,-2)),e+=");\n",null===this.codeblock&&Gibberish.upvalues.pushUnique("var "+this.symbol+" = Gibberish.functions."+this.symbol+";\n"),this.codeblock=e,this.dirty=!1,i},getCodeblock:function(){if(null!==this&&(null===this.codeblock&&this.codegen(),!Gibberish.memo[this.symbol])){if(Gibberish.memo[this.symbol]=this.variable,"analysis"!==this.type)for(var e in this.properties){var i=this.properties[e];if(Array.isArray(i.value))for(var t=i.value,r=0;t.length>r;r++){var n=t[r];"object"==typeof n&&null!==n&&n.getCodeblock()}else"object"==typeof i.value&&null!==i.value&&i.value.getCodeblock();if(i.binops)for(var s=0;i.binops.length>s;s++){var o=i.binops[s];"object"==typeof o.ugen&&null!==o.ugen&&o.ugen.getCodeblock()}}return"analysis"===this.type?Gibberish.codeblock.unshift(this.codeblock):Gibberish.codeblock.push(this.codeblock),this.variable}},defineUgenProperty:function(e,i){this.properties[e]={symbol:Gibberish.generateSymbol("v"),value:i,binops:[],getCodeblock:function(){"number"!=typeof this.value&&Gibberish.codeblock.push("var "+this.symbol+" = "+this.value+";\n")},codegen:function(){return"number"==typeof this.value||"string"==typeof this.value?this.value:this.symbol},parent:this,name:e},function(i){var t=e;Object.defineProperty(i,t,{configurable:!0,get:function(){return i.properties[t].value},set:function(e){i.properties[t].value=e,Gibberish.dirty(i)}})}(this)},init:function(e){if(e===void 0&&(e=!1),this.initalized||(this.symbol=Gibberish.generateSymbol(this.name),this.codeblock=null,this.variable=null),this.properties===void 0&&(this.properties={}),!this.initialized){this.destinations=[];for(var i in this.properties)this.defineUgenProperty(i,this.properties[i])}if(arguments.length>0&&"object"==typeof arguments[0][0]&&"undefined"===arguments[0][0].type){var t=arguments[0][0];for(var i in t)this[i]=t[i]}return Gibberish.functions[this.symbol]=this.callback,this.initialized=!0,this},mod:function(e,i,t){var r=this.properties[e],n={ugen:i,binop:t};r.binops.push(n),Gibberish.dirty(this)},removeMod:function(e,i){if(i===void 0)this.properties[e].binops.length=0;else if("number"==typeof i)this.properties[e].binops.splice(i,1);else if("object"==typeof i)for(var t=0,r=this.properties[e].binops.length;r>t;t++)this.properties[e].binops[t].ugen===i&&this.properties[e].binops.splice(t,1);Gibberish.dirty(this)},polyMod:function(e,i,t){for(var r=0;this.children.length>r;r++)this.children[r].mod(e,i,t);Gibberish.dirty(this)},removePolyMod:function(){var e=Array.prototype.slice.call(arguments,0);if("amp"!==arguments[0]&&"pan"!==arguments[0])for(var i=0;this.children.length>i;i++)this.children[i].removeMod.apply(this.children[i],e);else this.removeMod.apply(this,e);Gibberish.dirty(this)},smooth:function(e){var i=new Gibberish.OnePole;this.mod(e,i,"=")},connect:function(e){return e===void 0&&(e=Gibberish.out),-1===this.destinations.indexOf(e)&&(e.addConnection(this,1),this.destinations.push(e)),this},send:function(e,i){return-1===this.destinations.indexOf(e)?(e.addConnection(this,i),this.destinations.push(e)):e.adjustSendAmount(this,i),this},disconnect:function(e){if(e===void 0)for(var i=0;this.destinations.length>i;i++)this.destinations[i].removeConnection(this),this.destiGibbenations.splice(i);else e.removeConnection(this);return this}})}},Array2=function(){this.length=0},Array2.prototype=[],Array2.prototype.remove=function(e,i){if(i=i===void 0?!0:i,e===void 0){for(var t=0;this.length>t;t++)delete this[t];this.length=0}else if("number"==typeof e)this.splice(e,1);else if("string"==typeof e){for(var r=[],t=0;this.length>t;t++){var n=this[t];if(n.type===e||n.name===e){if(!i)return this.splice(t,1),void 0;r.push(t)}}for(var t=0;r.length>t;t++)this.splice(r[t],1)}else if("object"==typeof e)for(var s=this.indexOf(e);s>-1;)this.splice(s,1),s=this.indexOf(e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.get=function(e){if("number"==typeof e)return this[e];if("string"==typeof e)for(var i=0;this.length>i;i++){var t=this[i];if(t.name===e)return t}else if("object"==typeof e){var r=this.indexOf(e);if(r>-1)return this[r]}return null},Array2.prototype.replace=function(e,i){if(i.parent=this,i.input=e.input,"number"!=typeof e){var t=this.indexOf(e);t>-1&&this.splice(t,1,i)}else this.splice(e,1,i);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.insert=function(e,i){if(e.parent=this,this.input=this.parent,Array.isArray(e))for(var t=0;e.length>t;t++)this.splice(i+t,0,e[t]);else this.splice(i,0,e);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.add=function(){for(var e=0;arguments.length>e;e++)arguments[e].parent=this,arguments[e].input=this.parent,this.push(arguments[e]);this.parent&&(console.log("DIRTYING"),Gibberish.dirty(this.parent))},Array.prototype.pushUnique=function(){for(var e=0;arguments.length>e;e++){for(var i=arguments[e],t=!0,r=0;this.length>r;r++)if(i===this[r]){t=!1;break}t&&this.push(i)}};var rnd=Math.random;Gibberish.rndf=function(e,i,t,r){if(r=r===void 0?!0:r,t===void 0&&"object"!=typeof e){1==arguments.length?(e=0,i=arguments[0]):2==arguments.length?(e=arguments[0],i=arguments[1]):(e=0,i=1);var n=i-e,s=rnd(),o=n*s;return e+o}var a=[],h=[];t===void 0&&(t=i||e.length);for(var b=0;t>b;b++){var l;if("object"==typeof arguments[0])l=arguments[0][randomi(0,arguments[0].length-1)];else if(r)l=Gibberish.rndf(e,i);else{for(l=Gibberish.rndf(e,i);h.indexOf(l)>-1;)l=Gibberish.rndf(e,i);h.push(l)}a.push(l)}return a},Gibberish.extend=function(e,i){for(var t in i)t.split("."),i[t]instanceof Array&&100>i[t].length?(e[t]=i[t].slice(0),"fx"===t&&(e[t].parent=i[t].parent)):"object"!=typeof i[t]||null===i[t]||i[t]instanceof Float32Array?e[t]=i[t]:(e[t]=e[t]||{},arguments.callee(e[t],i[t]));return e},Function.prototype.clone=function(){return eval("["+(""+this)+"]")[0]},String.prototype.format=function(e,i,t){function r(){var r=this,n=arguments.length+1;for(e=0;n>e;t=arguments[e++])i=t,r=r.replace(RegExp("\\{"+(e-1)+"\\}","g"),i);return r}return r.native=String.prototype.format,r}(),Gibberish.Proxy=function(){var e=0;Gibberish.extend(this,{name:"proxy",type:"effect",properties:{},callback:function(){return e}}).init(),this.input=arguments[0],e=this.input.parent[this.input.name],delete this.input.parent[this.input.name],this.input.parent.properties[this.input.name].value=this,Object.defineProperty(this.input.parent,this.input.name,{get:function(){return e},set:function(i){e=i}}),Gibberish.dirty(this.input.parent)},Gibberish.Proxy.prototype=new Gibberish.ugen,Gibberish.oscillator=function(){this.type="oscillator",this.oscillatorInit=function(){return this.fx=new Array2,this.fx.parent=this,this}},Gibberish.oscillator.prototype=new Gibberish.ugen,Gibberish._oscillator=new Gibberish.oscillator,Gibberish.Sine=function(){this.name="sine",this.properties={frequency:arguments[0]||440,amp:arguments[1]||.5};var e=2*Math.PI,i=Math.sin,t=0;this.callback=function(r,n){return t+=r/44100,i(t*e)*n},this.init(arguments),this.oscillatorInit()},Gibberish.Sine.prototype=Gibberish._oscillator,Gibberish.Sine2=function(){this.__proto__=new Gibberish.Sine,this.name="sine2",this.defineUgenProperty("pan",0);var e=this.__proto__.callback,i=Gibberish.makePanner(),t=[0,0];this.callback=function(r,n,s){var o=e(r,n);return t=i(o,s,t)},this.init()},Gibberish.Saw=function(){this.name="saw",this.properties={frequency:440,amp:.15};var e=0;this.callback=function(i,t){var r=4*((e/2+.25)%.5-.25);return r*=t,e+=i/44100,e=e>1?e%1:e,r},this.init(),this.oscillatorInit()},Gibberish.Saw.prototype=Gibberish._oscillator,Gibberish.Saw2=function(){this.__proto__=new Gibberish.Saw,this.name="saw2",this.defineUgenProperty("pan",0);var e=this.__proto__.callback,i=Gibberish.makePanner(),t=[0,0];this.callback=function(r,n,s){var o=e(r,n);return t=i(o,s,t)},this.init()},Gibberish.Triangle=function(){var e=0,i=Math.abs;Gibberish.extend(this,{name:"triangle",properties:{frequency:440,amp:.15},callback:function(t,r){var n=1-4*i((e+.25)%1-.5);return n*=r,e+=t/44100,e=e>1?e%1:e,n}}).init().oscillatorInit()},Gibberish.Triangle.prototype=Gibberish._oscillator,Gibberish.Triangle2=function(){this.__proto__=new Gibberish.Triangle,this.name="triangle2",this.defineUgenProperty("pan",0);var e=this.__proto__.callback,i=Gibberish.makePanner(),t=[0,0];this.callback=function(r,n,s){var o=e(r,n);return i(o,s,t)},this.init()},Gibberish.Saw3=function(){var e=0,i=0,t=2.5,r=-1.5,n=0,s=Math.sin,o=11;pi_2=2*Math.PI,Gibberish.extend(this,{name:"saw",properties:{frequency:440,amp:.15},callback:function(a){var h=a/44100,b=.5-h,l=o*b*b*b*b,u=.376-.752*h,c=1-2*h,p=0;return i+=h,i-=i>1?2:0,e=.5*(e+s(pi_2*(i+e*l))),p=t*e+r*n,n=e,p+=u,p*c}}),Object.defineProperty(this,"scale",{get:function(){return o},set:function(e){o=e}}),this.init(),this.oscillatorInit()},Gibberish.Saw3.prototype=Gibberish._oscillator,Gibberish.PWM=function(){var e=0,i=0,t=0,r=0,n=0,s=2.5,o=-1.5,a=Math.sin,h=11;pi_2=2*Math.PI,test=0,Gibberish.extend(this,{name:"pwm",properties:{frequency:440,amp:.15,pulsewidth:.5},callback:function(b,l,u){var c=b/44100,p=.5-c,f=h*p*p*p*p,d=1-2*c,m=0;return n+=c,n-=n>1?2:0,e=.5*(e+a(pi_2*(n+e*f))),i=.5*(i+a(pi_2*(n+i*f+u))),m=i-e,m=s*m+o*(t-r),t=e,r=i,m*d*l}}),Object.defineProperty(this,"scale",{get:function(){return h},set:function(e){h=e}}),this.init(),this.oscillatorInit()},Gibberish.PWM.prototype=Gibberish._oscillator,Gibberish.Noise=function(){var e=Math.random;Gibberish.extend(this,{name:"noise",properties:{amp:1},callback:function(){return 2*e()-1}}),this.init(),this.oscillatorInit()},Gibberish.Noise.prototype=Gibberish._oscillator,Gibberish.KarplusStrong=function(){var e=[0],i=0,t=Math.random,r=Gibberish.makePanner(),n=[0,0];Gibberish.extend(this,{name:"karplus_strong",properties:{blend:1,damping:0,amp:1,channels:2,pan:0},note:function(i){var t=Math.floor(44100/i);e.length=0;for(var r=0;t>r;r++)e[r]=2*Math.random()-1},callback:function(s,o,a,h,b){var l=e.shift(),u=t()>s?-1:1;o=o>0?o:0;var c=u*(l+i)*(.5-o/100);return i=c,e.push(c),c*=a,1===h?c:r(c,b,n)}}).init().oscillatorInit()},Gibberish.KarplusStrong.prototype=Gibberish._oscillator,Gibberish.PolyKarplusStrong=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"poly_karplus_strong",maxVoices:5,voiceCount:0,polyProperties:{blend:1,damping:0},note:function(e,i){var t=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),t.note(e,i)}}),this.amp=1/this.maxVoices,this.processProperties(arguments),this.children=[],this.dirty=!0;for(var e=0;this.maxVoices>e;e++){var i={blend:this.blend,damping:this.damping,channels:2,amp:1},t=new Gibberish.KarplusStrong(i).connect(this);this.children.push(t)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},Gibberish.bus=function(){this.type="bus",this.inputCodegen=function(){var e=this.value.codegen(),i=1===this.amp?e:e+" * "+this.amp;return this.codeblock=i,i},this.addConnection=function(){var e={value:arguments[0],amp:arguments[1],codegen:this.inputCodegen};e.getCodeblock=e.value.getCodeblock.bind(e.value),this.inputs.push(e),Gibberish.dirty(this)},this.removeConnection=function(e){for(var i=0;this.inputs.length>i;i++)if(this.inputs[i].value===e){this.inputs.splice(i,1),Gibberish.dirty(this);break}},this.adjustSendAmount=function(e,i){for(var t=0;this.inputs.length>t;t++)if(this.inputs[t].value===e){this.inputs[t].amp=i,Gibberish.dirty(this);break}},this.callback=function(){var e=arguments[arguments.length-2],i=arguments[arguments.length-1];output[0]=output[1]=0;for(var t=0;arguments.length-2>t;t++){var r="object"==typeof arguments[t];output[0]+=r?arguments[t][0]:arguments[t],output[1]+=r?arguments[t][1]:arguments[t]}return output[0]*=e,output[1]*=e,panner(output,i,output)}},Gibberish.bus.prototype=new Gibberish.ugen,Gibberish._bus=new Gibberish.bus,Gibberish.Bus=function(){return Gibberish.extend(this,{name:"bus",properties:{inputs:[],amp:arguments[1]||1},callback:function(){for(var e=0,i=arguments.length-1,t=arguments[i],r=0;i>r;r++)e+=args[r];return e*=t}}),this.init(),this},Gibberish.Bus.prototype=Gibberish._bus,Gibberish.Bus2=function(){this.name="bus2",this.type="bus",this.properties={inputs:[],amp:arguments[1]||1,pan:0};var e=[0,0],i=Gibberish.makePanner();this.callback=function(){var t=arguments[arguments.length-2],r=arguments[arguments.length-1];e[0]=e[1]=0;for(var n=0;arguments.length-2>n;n++){var s="object"==typeof arguments[n];e[0]+=s?arguments[n][0]:arguments[n],e[1]+=s?arguments[n][1]:arguments[n]}return e[0]*=t,e[1]*=t,i(e,r,e)},this.initialized=!1,this.init()},Gibberish.Bus2.prototype=Gibberish._bus,Gibberish.envelope=function(){this.type="envelope"},Gibberish.envelope.prototype=new Gibberish.ugen,Gibberish._envelope=new Gibberish.envelope,Gibberish.Line=function(e,i,t,r){var n={name:"line",properties:{start:e||0,end:isNaN(i)?1:i,time:t||44100,loops:r||!1}},s=0,o=(i-e)/t;return this.callback=function(e,i,t,r){var n=t>s?e+s++*o:i;return s=n>=i&&r?0:s,n},Gibberish.extend(this,n),this.init(),this},Gibberish.Line.prototype=Gibberish._envelope,Gibberish.AD=function(e,i){var t=0,r=0;Gibberish.extend(this,{name:"AD",properties:{attack:e||1e4,decay:i||1e4},run:function(){return r=0,t=0,this},callback:function(e,i){if(e=0>e?_4:e,i=0>i?_4:i,0===r){var n=1/e;t+=n,t>=1&&r++}else if(1===r){var n=1/i;t-=n,0>=t&&(t=0,r++)}return t},getState:function(){return r}}).init().processProperties(arguments)},Gibberish.AD.prototype=Gibberish._envelope,Gibberish.ADSR=function(e,i,t,r,n,s){var o={name:"adsr",type:"envelope",properties:{attack:isNaN(e)?1e4:e,decay:isNaN(i)?1e4:i,release:isNaN(r)?1e4:r,sustain:t===void 0?88200:t,attackLevel:n||1,sustainLevel:s||.5},run:function(){this.setPhase(0),this.setState(0)}};Gibberish.extend(this,o);var a=0,h=0;return this.callback=function(e,i,t,r,n,s){var o=0;return 0===h?(o=a/e*n,1===++a/e&&(h++,a=i)):1===h?(o=a/i*(n-s)+s,0>=--a&&(null!==t?(h+=1,a=t):(h+=2,a=r))):2===h?(o=s,0===a--&&(h++,a=r)):3===h&&(a--,o=a/r*s,0>=a&&h++),o},this.setPhase=function(e){a=e},this.setState=function(e){h=e,a=0},this.getState=function(){return h},this.init(),this},Gibberish.ADSR.prototype=Gibberish._envelope,Gibberish.analysis=function(){this.type="analysis",this.codegen=function(){return Gibberish.memo[this.symbol]?Gibberish.memo[this.symbol]:(v=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=v,this.variable=v,Gibberish.upvalues.push("var "+this.symbol+" = Gibberish.functions."+this.symbol+";\n"),this.codeblock="var "+this.variable+" = "+this.symbol+"();\n",this.variable)},this.codegen2=function(){for(var e in this.properties){var i=this.properties[e];if(Array.isArray(i.value))for(var t=0;i.value.length>t;t++){var r=i.value[t];"object"==typeof r&&(r.type="ddd",r.codegen(),r.getCodeblock(),r.type="analysis")}else if("object"==typeof i.value&&!Gibberish.memo[i.value.symbol]){i.value.type="ddd",i.value.codegen(),i.value.getCodeblock(),Gibberish.codeblock.push(i.value.codeblock),i.value.type="analysis";var n=i.value.variable?i.value.variable:Gibberish.generateSymbol("v");Gibberish.memo[i.value.symbol]=n,i.value.variable=n,Gibberish.codestring="var "+i.value.symbol+" = Gibberish.functions."+i.value.symbol+";\n"+Gibberish.codestring}if(i.binops)for(var s=0;i.binops.length>s;s++){var o=i.binops[s];"object"==typeof o.ugen&&o.ugen.codegen()}}},this.analysisCodegen=function(){var e=this.analysisSymbol+"("+this.input.variable+",";for(var i in this.properties)"input"!==i&&(e+=this[i]+",");return e=e.slice(0,-1),e+=");",this.analysisCodeblock=e,e},this.analysisInit=function(){this.analysisSymbol=Gibberish.generateSymbol(this.name),Gibberish.functions[this.analysisSymbol]=this.analysisCallback,Gibberish.upvalues.push("var "+this.analysisSymbol+" = Gibberish.functions."+this.analysisSymbol+";\n"),Gibberish.analysisUgens.push(this)}},Gibberish.analysis.prototype=new Gibberish.ugen,Gibberish._analysis=new Gibberish.analysis,Gibberish.Follow=function(){this.name="follow",this.properties={mult:1,input:0,bufferSize:4410};var e=Math.abs,i=[0],t=0,r=0,n=0;this.analysisCallback=function(s,o,a){t+=e(s),t-=i[r],i[r]=e(s),r=(r+1)%o,i[r]=i[r]?i[r]:0,n=t/o*a},this.callback=function(){return n},this.init()},Gibberish.Follow.prototype=Gibberish._analysis,Gibberish.SingleSampleDelay=function(){this.name="single_sample_delay",this.properties={input:arguments[0]||0,amp:arguments[1]||1};var e=0;this.analysisCallback=function(i,t){e="object"==typeof i?"object"==typeof i?[i[0]*t,i[1]*t]:i*t:i*t},this.callback=function(){return e},this.init(),this.analysisInit()},Gibberish.SingleSampleDelay.prototype=Gibberish._analysis,Gibberish.Record=function(e,i,t){var r=new Float32Array(i),n=0,s=!1,o=this;Gibberish.extend(this,{name:"record",oncomplete:t,properties:{input:0,size:i||0},analysisCallback:function(e,i){s&&(r[n++]="object"==typeof e?e[0]+e[1]:e,n>=i&&(s=!1,o.remove()))},record:function(){return n=0,s=!0,this},getBuffer:function(){return r},getPhase:function(){return n},remove:function(){this.oncomplete!==void 0&&this.oncomplete();for(var e=0;Gibberish.analysisUgens.length>e;e++){var i=Gibberish.analysisUgens[e];if(i===this)return Gibberish.analysisUgens.splice(e,1),void 0}}}),this.properties.input=e,this.init(),this.analysisInit(),Gibberish.dirty()},Gibberish.Record.prototype=Gibberish._analysis,Gibberish.effect=function(){this.type="effect"},Gibberish.effect.prototype=new Gibberish.ugen,Gibberish._effect=new Gibberish.effect,Gibberish.Distortion=function(){var e=Math.abs,i=Math.log,t=Math.LN2;Gibberish.extend(this,{name:"distortion",properties:{input:0,amount:50},callback:function(r,n){var s;return"number"==typeof r?(s=r*n,r=s/(1+e(s))/(i(n)/t)):(s=r[0]*n,r[0]=s/(1+e(s))/(i(n)/t),s=r[1]*n,r[1]=s/(1+e(s))/(i(n)/t)),r}}).init().processProperties(arguments)},Gibberish.Distortion.prototype=Gibberish._effect,Gibberish.Delay=function(){var e=[],i=0;e.push(new Float32Array(88200)),e.push(new Float32Array(88200)),Gibberish.extend(this,{name:"Delay",properties:{input:0,time:22050,feedback:.5,channels:1},callback:function(t,r,n){var s="number"==typeof t?1:2,o=i++%88200,a=(o+r)%88200;return 1===s?(e[0][a]=(t+e[0][o])*n,t+=e[0][o]):(e[0][a]=(t[0]+e[0][o])*n,t[0]+=e[0][o],e[1][a]=(t[1]+e[1][o])*n,t[1]+=e[1][o]),t}}).init().processProperties(arguments)},Gibberish.Delay.prototype=Gibberish._effect,Gibberish.Decimator=function(){var e=0,i=[],t=Math.pow,r=Math.floor;Gibberish.extend(this,{name:"Decimator",properties:{input:0,bitDepth:16,sampleRate:1},callback:function(n,s,o){e+=o;var a="number"==typeof n?1:2;if(1===a){if(e>=1){var h=t(s,2);i[0]=r(n*h)/h,e-=1}n=i[0]}else{if(e>=1){var h=t(s,2);i[0]=r(n[0]*h)/h,i[1]=r(n[1]*h)/h,e-=1}n=i}return n}}).init().processProperties(arguments)},Gibberish.Decimator.prototype=Gibberish._effect,Gibberish.RingModulation=function(){var e=(new Gibberish.Sine).callback,i=[0,0];Gibberish.extend(this,{name:"ringmod",properties:{input:0,frequency:440,amp:.5,mix:.5},callback:function(t,r,n,s){var o="number"==typeof t?1:2,a=1===o?t:t[0],h=e(r,n);if(a=a*(1-s)+a*h*s,2===o){var b=t[1];return b=b*(1-s)+b*h*s,i[0]=a,i[1]=b,i}return a}}).init().processProperties(arguments)},Gibberish.RingModulation.prototype=Gibberish._effect,Gibberish.OnePole=function(){var e=0;Gibberish.extend(this,{name:"onepole",type:"effect",properties:{input:null,a0:.15,b1:.85},callback:function(i,t,r){var n=i*t+e*r;return e=n,n},smooth:function(e,i){this.input=i.properties[e],i.mod(e,this,"=")}}).init().processProperties(arguments)},Gibberish.OnePole.prototype=Gibberish._effect,Gibberish.Filter24=function(){var e=[0,0,0,0],i=[0,0,0,0],t=[0,0],r=isNaN(arguments[0])?.1:arguments[0],n=isNaN(arguments[1])?3:arguments[1];_isLowPass=arguments[2]!==void 0?arguments[2]:!0,Gibberish.extend(this,{name:"filter24",properties:{input:0,cutoff:r,resonance:n,isLowPass:_isLowPass},callback:function(r,n,s,o){var a="number"==typeof r?1:2,h=1===a?r:r[0],b=e[3]*s;if(b=b>1?1:b,n=0>n?0:n,n=n>1?1:n,h-=b,e[0]=e[0]+(-e[0]+h)*n,e[1]=e[1]+(-e[1]+e[0])*n,e[2]=e[2]+(-e[2]+e[1])*n,e[3]=e[3]+(-e[3]+e[2])*n,h=o?e[3]:h-e[3],2===a){var l=r[1];return b=i[3]*s,b=b>1?1:b,l-=b,i[0]=i[0]+(-i[0]+l)*n,i[1]=i[1]+(-i[1]+i[0])*n,i[2]=i[2]+(-i[2]+i[1])*n,i[3]=i[3]+(-i[3]+i[2])*n,l=o?i[3]:l-i[3],t[0]=h,t[1]=h,t}return h}}).init().processProperties(arguments)},Gibberish.Filter24.prototype=Gibberish._effect,Gibberish.SVF=function(){var e=[0,0],i=[0,0],t=Math.PI,r=[0,0];Gibberish.extend(this,{name:"SVF",properties:{input:0,cutoff:440,Q:2,mode:0},callback:function(n,s,o,a){var h="number"==typeof n?1:2,b=1===h?n:n[0],l=2*t*s/44100;o=1/o;var u=i[0]+l*e[0],c=b-u-o*e[0],p=l*c+e[0],f=c+u;if(e[0]=p,i[0]=u,b=0===a?u:1===a?c:2===a?p:f,2===h){var d=n[1],u=i[1]+l*e[1],c=d-u-o*e[1],p=l*c+e[1],f=c+u;e[1]=p,i[1]=u,d=0===a?u:1===a?c:2===a?p:f,r[0]=b,r[1]=d}else r=b;return r}}).init().processProperties(arguments)},Gibberish.SVF.prototype=Gibberish._effect,Gibberish.Biquad=function(){var e=[0,0],i=[0,0],t=[0,0],r=[0,0],n=[0,0];Gibberish.extend(this,{name:"biquad",mode:"LP",cutoff:2e3,Q:.5,properties:{input:null,b0:.001639,b1:.003278,b2:.001639,a1:-1.955777,a2:.960601},calculateCoefficients:function(){switch(this.mode){case"LP":var e=2*Math.PI*this.cutoff/44100,i=Math.sin(e),t=Math.cos(e),r=i/(2*this.Q),n=(1-t)/2,s=1-t,o=n,a=1+r,h=-2*t,b=1-r;break;case"HP":var e=2*Math.PI*this.cutoff/44100,i=Math.sin(e),t=Math.cos(e),r=i/(2*this.Q),n=(1+t)/2,s=-(1+t),o=n,a=1+r,h=-2*t,b=1-r;break;case"BP":var e=2*Math.PI*this.cutoff/44100,i=Math.sin(e),t=Math.cos(e),l=Math.log(2)/2*this.Q*e/i,r=i*(Math.exp(l)-Math.exp(-l))/2,n=r,s=0,o=-r,a=1+r,h=-2*t,b=1-r;break;default:return}this.b0=n/a,this.b1=s/a,this.b2=o/a,this.a1=h/a,this.a2=b/a},call:function(e){return this.function(e,this.b0,this.b1,this.b2,this.a1,this.a2)},callback:function(s,o,a,h,b,l){var u="number"==typeof s?1:2,c=0,p=0,f=1===u?s:s[0];return c=o*f+a*e[0]+h*i[0]-b*t[0]-l*r[0],i[0]=e[0],e[0]=s[0],r[0]=t[0],t[0]=c,2===u&&(inR=s[1],p=o*inR+a*e[1]+h*i[1]-b*t[1]-l*r[1],i[1]=e[1],e[1]=s[1],r[1]=t[1],t[1]=p,n[0]=c,n[1]=p),1===u?c:n}}).init().processProperties(arguments),this.calculateCoefficients()},Gibberish.Biquad.prototype=Gibberish._effect,Gibberish.Flanger=function(){var e=[new Float32Array(88200),new Float32Array(88200)],i=88200,t=(new Gibberish.Sine).callback,r=Gibberish.interpolate,n=-100,s=0;Gibberish.extend(this,{name:"flanger",properties:{input:0,rate:.25,amount:125,feedback:0,offset:125},callback:function(o,a,h,b,l,u){var u="number"==typeof o?1:2,c=n+t(a,.95*h);c>i?c-=i:0>c&&(c+=i);var p=r(e[0],c);return e[0][s]=1===u?o+p*b:o[0]+p*b,2===u?(o[0]+=p,p=r(e[1],c),e[1][s]=o[1]+p*b,o[1]+=p):o+=p,++s>=i&&(s=0),++n>=i&&(n=0),o}}).init().processProperties(arguments),n=-1*this.offset},Gibberish.Flanger.prototype=Gibberish._effect,Gibberish.Vibrato=function(){var e=[new Float32Array(88200),new Float32Array(88200)],i=88200,t=(new Gibberish.Sine).callback,r=Gibberish.interpolate,n=-100,s=0;Gibberish.extend(this,{name:"vibrato",properties:{input:0,rate:5,amount:.5,offset:125},callback:function(o,a,h,b,l){var l="number"==typeof o?1:2,u=n+t(a,h*b-1);u>i?u-=i:0>u&&(u+=i);var c=r(e[0],u);return e[0][s]=1===l?o:o[0],2===l?(o[0]=c,c=r(e[1],u),e[1][s]=o[1],o[1]=c):o=c,++s>=i&&(s=0),++n>=i&&(n=0),o}}).init().processProperties(arguments),n=-1*this.offset},Gibberish.Vibrato.prototype=Gibberish._effect,Gibberish.BufferShuffler=function(){var e=[new Float32Array(88200),new Float32Array(88200)],i=88200,t=0,r=0,n=0,s=0,o=0,a=Math.random,h=1,b=!1,l=!1,u=!1,c=Gibberish.interpolate,p=!1,f=1,d=!1,m=Gibberish.rndf,v=[0,0];Gibberish.extend(this,{name:"buffer_shuffler",properties:{input:0,chance:.25,rate:11025,length:22050,reverseChange:.5,pitchChance:.5,pitchMin:.25,pitchMax:2,wet:1,dry:0},callback:function(y,g,G,k,_,w,P,S,A,x){var M="number"==typeof y?1:2;o?0===++s%(k-400)&&(b=!1,l=!0,h=1,s=0):(e[0][r]=1===M?y:y[0],e[1][r]=1===M?y:y[1],r++,r%=i,d=0===r?1:d,n++,0==n%G&&g>a()&&(u=_>a(),o=!0,u||(t=r-k,0>t&&(t=i+t)),p=w>a(),p&&(f=m(P,S)),h=1,b=!0,l=!1)),t+=u?-1*f:f,0>t?t+=i:t>i&&(t-=i);var F,C,I,D,L=c(e[0],t);return b?(h-=.0025,I=L*(1-h),F=1===M?I+y*h:I+y[0]*h,2===M&&(D=c(e[1],t),I=D*(1-h),C=1===M?F:I+y[1]*h),.0025>=h&&(b=!1)):l?(h-=.0025,I=L*h,F=1===M?I+y*h:I+y[0]*(1-h),2===M&&(D=c(e[1],t),I=D*h,C=I+y[1]*(1-h)),.0025>=h&&(l=!1,o=!1,u=!1,f=1,p=0)):1===M?F=o&&d?L*A+y*x:y:(D=c(e[1],t),F=o&&d?L*A+y[0]*x:y[0],C=o&&d?D*A+y[1]*x:y[1]),v=[F,C],1===M?F:v}}).init().processProperties(arguments)},Gibberish.BufferShuffler.prototype=Gibberish._effect,Gibberish.AllPass=function(e){var i=-1,t=new Float32Array(e||500),r=t.length;Gibberish.extend(this,{name:"allpass",properties:{input:0},callback:function(e){i=++i%r;var n=t[i],s=-1*e+n;return t[i]=e+.5*n,s}})},Gibberish.Comb=function(e){var i=new Float32Array(e||1200),t=i.length,r=0,n=0;Gibberish.extend(this,{name:"comb",properties:{input:0,time:e||1200},callback:function(e){var s=++r%t,o=i[s];return n=.8*o+.2*n,i[s]=e+.84*n,o}})},Gibberish.Reverb=function(){var e={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.9,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},i=[],t=[],r=[0,0];Gibberish.extend(this,{name:"Reverb",roomSize:.5,damping:.2223,properties:{input:0,wet:.5,dry:.55},callback:function(e,n,s){for(var o="object"==typeof e?2:1,a=1===o?e:e[0]+e[1],h=.015*a,b=h,l=0;8>l;l++){var u=i[l](h);b+=u}for(var l=0;4>l;l++)b=t[l](b);return r[0]=r[1]=a*s+b*n,r}}).init().processProperties(arguments);for(var n=0;8>n;n++)i.push(new Gibberish.Comb(e.combTuning[n],this.roomSize*e.scaleRoom*e.offsetRoom,this.damping).callback);for(var n=0;4>n;n++)t.push(new Gibberish.AllPass(e.allPassTuning[n],e.allPassFeedback).callback)},Gibberish.Reverb.prototype=Gibberish._effect,Gibberish.Granulator=function(e){var i=[];buffer=null,interpolate=Gibberish.interpolate,panner=Gibberish.makePanner(),bufferLength=0,debug=0,write=0,self=this,out=[0,0],_out=[0,0],rndf=Gibberish.rndf,numberOfGrains=e.numberOfGrains||20,Gibberish.extend(this,{name:"granulator",bufferLength:88200,reverse:!0,spread:.5,properties:{speed:1,speedMin:0,speedMax:0,grainSize:1e3,position:.5,positionMin:0,positionMax:0,amp:.2,fade:.1,pan:0,shouldWrite:!1},callback:function(e,t,r,n,s,o,a,h,b,l){for(var u=0;numberOfGrains>u;u++){var c=i[u];if(c._speed>0){c.pos>c.end&&(c.pos=(a+rndf(s,o))*buffer.length,c.start=c.pos,c.end=c.start+n,c._speed=e+rndf(t,r),c._speed=.1>c._speed?.1:c._speed,c._speed=.1>c._speed&&c._speed>0?.1:c._speed,c._speed=c._speed>-.1&&0>c._speed?-.1:c._speed,c.fadeAmount=c._speed*b*n,c.pan=rndf(-1*self.spread,self.spread));for(var p=c.pos;p>buffer.length;)p-=buffer.length;for(;0>p;)p+=buffer.length;var f=interpolate(buffer,p);f*=c.pos<c.fadeAmount+c.start?(c.pos-c.start)/c.fadeAmount:1,f*=c.pos>c.end-c.fadeAmount?(c.end-c.pos)/c.fadeAmount:1
}else{c.pos<c.end&&(c.pos=(a+rndf(s,o))*buffer.length,c.start=c.pos,c.end=c.start-n,c._speed=e+rndf(t,r),c._speed=.1>c._speed&&c._speed>0?.1:c._speed,c._speed=c._speed>-.1&&0>c._speed?-.1:c._speed,c.fadeAmount=c._speed*b*n);for(var p=c.pos;p>buffer.length;)p-=buffer.length;for(;0>p;)p+=buffer.length;var f=interpolate(buffer,p);f*=c.pos>c.start-c.fadeAmount?(c.start-c.pos)/c.fadeAmount:1,f*=c.pos<c.end+c.fadeAmount?(c.end-c.pos)/c.fadeAmount:1}_out=panner(f*h,c.pan,_out),out[0]+=_out[0],out[1]+=_out[1],c.pos+=c._speed}return panner(out,l,out)}}).init().processProperties(arguments);for(var t=0;numberOfGrains>t;t++)i[t]={pos:self.position+Gibberish.rndf(self.positionMin,self.positionMax),_speed:self.speed+Gibberish.rndf(self.speedMin,self.speedMax)},i[t].start=i[t].pos,i[t].end=i[t].pos+self.grainSize,i[t].fadeAmount=i[t]._speed*self.fade*self.grainSize,i[t].pan=Gibberish.rndf(-1*self.spread,self.spread);e.input!==void 0?(that.shouldWrite=!0,that.sampler=new Gibberish.Sampler,that.sampler.connect(),that.sampler.record(e.buffer,that.bufferLength),that.buffer=that.sampler.buffer):e.buffer!==void 0&&(buffer=e.buffer,bufferLength=buffer.length)},Gibberish.Granulator.prototype=Gibberish._effect,Gibberish.synth=function(){this.type="oscillator",this.oscillatorInit=function(){this.fx=new Array2,this.fx.parent=this}},Gibberish.synth.prototype=new Gibberish.ugen,Gibberish._synth=new Gibberish.synth,Gibberish.Synth=function(){this.name="synth",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,glide:.15,amp:.25,channels:2,pan:0},this.note=function(i,t){this.frequency=i,_frequency=i,t!==void 0&&(this.amp=t),e.run()};var e=new Gibberish.AD,i=e.getState,t=e.callback,r=new Gibberish.PWM,n=r.callback,s=(new Gibberish.OnePole).callback,o=Gibberish.makePanner(),a=[0,0];this.callback=function(e,r,h,b,l,u,c,p){if(l=l>=1?.99999:l,e=s(e,1-l,l),2>i()){var f=t(h,b),d=n(e,1,r)*f*u;return a[0]=a[1]=d,1===c?d:o(d,p,a)}return d=a[0]=a[1]=0,1===c?d:o(d,p,a)},this.getOsc=function(){return r},this.setOsc=function(e){r=e,n=r.callback};var h="PWM";Object.defineProperty(this,"waveform",{get:function(){return h},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth.prototype=Gibberish._synth,Gibberish.PolySynth=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth",maxVoices:5,voiceCount:0,polyProperties:{glide:0,attack:22050,decay:22050,pulsewidth:.5,waveform:"PWM"},note:function(e,i){var t=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),t.note(e,i)}}),this.amp=1/this.maxVoices,this.processProperties(arguments),this.children=[],this.dirty=!0;for(var e=0;this.maxVoices>e;e++){var i={attack:this.attack,decay:this.decay,pulsewidth:this.pulsewidth,channels:2,amp:1},t=new Gibberish.Synth(i);t.connect(this),this.children.push(t)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Synth2=function(){this.name="synth2",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,cutoff:.25,resonance:3.5,useLowPassFilter:!0,glide:.15,amp:.25,channels:1,pan:0},this.note=function(i,t){this.frequency=i,_frequency=i,t!==void 0&&(this.amp=t),e.run()};var e=new Gibberish.AD,i=e.getState,t=e.callback,r=new Gibberish.PWM,n=r.callback,s=new Gibberish.Filter24,o=s.callback,a=(new Gibberish.OnePole).callback,h=Gibberish.makePanner(),b=[0,0];this.callback=function(e,r,s,l,u,c,p,f,d,m,v){if(2>i()){f=f>=1?.99999:f,e=a(e,1-f,f);var y=t(s,l),g=o(n(e,.15,r),u*y,c,p)*y*d;return b[0]=b[1]=g,1===m?g:h(g,v,b)}return g=b[0]=b[1]=0,1===m?g:h(g,v,b)},this.getOsc=function(){return r},this.setOsc=function(e){r=e,n=r.callback};var l="PWM";Object.defineProperty(this,"waveform",{get:function(){return l},set:function(e){this.setOsc(new Gibberish[e])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth2.prototype=Gibberish._synth,Gibberish.FMSynth=function(){this.name="fmSynth",this.properties={frequency:0,cmRatio:2,index:5,attack:22050,decay:22050,glide:.15,amp:.25,channels:2,pan:0},this.note=function(i,t){this.frequency=i,_frequency=i,t!==void 0&&(this.amp=t),e.run()};var e=new Gibberish.AD,i=e.getState,t=e.callback,r=(new Gibberish.Sine).callback,n=(new Gibberish.Sine).callback,s=(new Gibberish.OnePole).callback,o=Gibberish.makePanner(),a=[0,0];this.callback=function(e,h,b,l,u,c,p,f,d){if(2>i()){c>=1&&(c=.9999),e=s(e,1-c,c);var m=t(l,u),v=n(e*h,e*b,1,1)*m,y=r(e+v,1,1)*m*p;return a[0]=a[1]=y,1===f?y:o(y,d,a)}return y=a[0]=a[1]=0,1===f?y:o(y,d,a)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.FMSynth.prototype=Gibberish._synth,Gibberish.PolyFM=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polyfm",maxVoices:5,voiceCount:0,children:[],polyProperties:{glide:0,attack:22050,decay:22050,index:5,cmRatio:2},note:function(e,i){var t=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),t.note(e,i)}}),this.amp=1/this.maxVoices,this.processProperties(arguments);for(var e=0;this.maxVoices>e;e++){var i={attack:this.attack,decay:this.decay,cmRatio:this.cmRatio,index:this.index,channels:2,amp:1},t=new Gibberish.FMSynth(i);t.connect(this),this.children.push(t)}Gibberish.polyInit(this),Gibberish._synth.oscillatorInit.call(this)},AudioFileRequest.prototype.onSuccess=function(){},AudioFileRequest.prototype.onFailure=function(){},AudioFileRequest.prototype.send=function(){if("wav"!=this.extension&&"aiff"!=this.extension&&"aif"!=this.extension)return this.onFailure(),void 0;var e=new XMLHttpRequest;e.open("GET",this.url,this.async),e.overrideMimeType("text/plain; charset=x-user-defined"),e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0==e.status?this.handleResponse(e.responseText):this.onFailure())}.bind(this),e.send(null)},AudioFileRequest.prototype.handleResponse=function(e){var i,t;"wav"==this.extension?(i=new WAVDecoder,t=i.decode(e)):("aiff"==this.extension||"aif"==this.extension)&&(i=new AIFFDecoder,t=i.decode(e)),this.onSuccess(t)},Decoder.prototype.readString=function(e,i,t){return e.slice(i,i+t)},Decoder.prototype.readIntL=function(e,i,t){for(var r=0,n=0;t>n;n++)r+=(255&e.charCodeAt(i+n))*Math.pow(2,8*n);return r},Decoder.prototype.readChunkHeaderL=function(e,i){var t={};return t.name=this.readString(e,i,4),t.length=this.readIntL(e,i+4,4),t},Decoder.prototype.readIntB=function(e,i,t){for(var r=0,n=0;t>n;n++)r+=(255&e.charCodeAt(i+n))*Math.pow(2,8*(t-n-1));return r},Decoder.prototype.readChunkHeaderB=function(e,i){var t={};return t.name=this.readString(e,i,4),t.length=this.readIntB(e,i+4,4),t},Decoder.prototype.readFloatB=function(e,i){var t=this.readIntB(e,i,2),r=32768;t>=r&&(t|=~(r-1));var n=1;0>t&&(n=-1,t+=r);var s,o=this.readIntB(e,i+2,4),a=this.readIntB(e,i+6,4);return 0==(t==o==a)?s=0:32767==t?s=Number.MAX_VALUE:(t-=16383,s=(4294967296*o+a)*Math.pow(2,t-63)),n*s},WAVDecoder.prototype.__proto__=Decoder.prototype,WAVDecoder.prototype.decode=function(e){var i={},t=0,r=this.readChunkHeaderL(e,t);if(t+=8,"RIFF"!=r.name)return console.error("File is not a WAV"),null;var n=r.length;n+=8;var s=this.readString(e,t,4);if(t+=4,"WAVE"!=s)return console.error("File is not a WAV"),null;for(;n>t;){var r=this.readChunkHeaderL(e,t);if(t+=8,"fmt "==r.name){var o=this.readIntL(e,t,2);if(t+=2,1!=o)return console.error("Cannot decode non-PCM encoded WAV file"),null;var a=this.readIntL(e,t,2);t+=2;var h=this.readIntL(e,t,4);t+=4,t+=4,t+=2;var b=this.readIntL(e,t,2),l=b/8;t+=2}else if("data"==r.name){for(var u=r.length/(l*a),c=[],p=0;a>p;p++)c.push(new Float32Array(u));for(var p=0;a>p;p++)for(var f=c[p],d=0;u>d;d++){var m=t;m+=(d*a+p)*l;var v=this.readIntL(e,m,l),y=1<<b-1;v>=y&&(v|=~(y-1)),f[d]=v/y}t+=r.length}else t+=r.length}return i.sampleRate=h,i.bitDepth=b,i.channels=c,i.length=u,i},AIFFDecoder.prototype.__proto__=Decoder.prototype,AIFFDecoder.prototype.decode=function(e){var i={},t=0,r=this.readChunkHeaderB(e,t);if(t+=8,"FORM"!=r.name)return console.error("File is not an AIFF"),null;var n=r.length;n+=8;var s=this.readString(e,t,4);if(t+=4,"AIFF"!=s)return console.error("File is not an AIFF"),null;for(;n>t;){var r=this.readChunkHeaderB(e,t);if(t+=8,"COMM"==r.name){var o=this.readIntB(e,t,2);t+=2;var a=this.readIntB(e,t,4);t+=4;for(var h=[],b=0;o>b;b++)h.push(new Float32Array(a));var l=this.readIntB(e,t,2),u=l/8;t+=2;var c=this.readFloatB(e,t);t+=10}else if("SSND"==r.name){var p=this.readIntB(e,t,4);t+=4,t+=4,t+=p;for(var b=0;o>b;b++)for(var f=h[b],d=0;a>d;d++){var m=t;m+=(d*o+b)*u;var v=this.readIntB(e,m,u),y=1<<l-1;v>=y&&(v|=~(y-1)),f[d]=v/y}t+=r.length-p-8}else t+=r.length}return i.sampleRate=c,i.bitDepth=l,i.channels=h,i.length=a,i},Gibberish.Sampler=function(){var e=1,i=Gibberish.interpolate,t=Gibberish.makePanner(),r=[0,0],n=null,s=1,o=this;if(Gibberish.extend(this,{name:"sampler",file:null,isLoaded:!1,playOnLoad:0,properties:{pitch:1,amp:1,isRecording:!1,isPlaying:!0,input:0,length:0,start:0,end:1,loops:0,pan:0},_onload:function(i){n=i.channels[0],s=i.length,o.end=s,o.length=e=s,console.log("LOADED ",o.file,s),Gibberish.audioFiles[o.file]=n,o.onload&&o.onload(),0!==o.playOnLoad&&o.note(o.playOnLoad),o.isLoaded=!0},note:function(i,t){"number"==typeof t&&(this.amp=t),this.pitch=i,null!==this.function&&(this.isPlaying=!0,e=i>0?this.start:this.end)},record:function(i,t){this.isRecording=!0;var r=this;new Gibberish.Record(i,t,function(){n=this.getBuffer(),r.end=s=n.length,e=r.end,r.isRecording=!1}).record()},getBuffer:function(){return n},callback:function(s,o,a,h,b,l,u,c,p,f){var d=0;return e+=s,c>e&&e>0?(s>0?d=null!==n&&h?i(n,e):0:e>u?d=null!==n&&h?i(n,e):0:e=p?c:e,t(d,f,r)):(e=p&&s>0?u:e,e=p&&0>s?c:e,r[0]=r[1]=d,r)}}).init().oscillatorInit().processProperties(arguments),arguments[0]!==void 0&&("string"==typeof arguments[0]?(console.log("SETTING FILE"),this.file=arguments[0],delete arguments[0]):"object"==typeof arguments[0]&&arguments[0].file&&(this.file=arguments[0].file)),console.log(this),Gibberish.audioFiles[this.file]!==void 0)n=Gibberish.audioFiles[this.file],this.end=this.bufferLength=n.length,e=this.bufferLength,Gibberish.dirty(this),this.onload&&this.onload();else if(null!==this.file){var a=new AudioFileRequest(this.file);a.onSuccess=this._onload,a.send()}else this.buffer!==void 0&&(this.isLoaded=!0,n=this.buffer,this.end=this.bufferLength=n.length,e=this.bufferLength,arguments[0]&&arguments[0].loops&&(this.loops=1),Gibberish.dirty(this),this.onload&&this.onload())},Gibberish.Sampler.prototype=Gibberish._oscillator,Gibberish.MonoSynth=function(){Gibberish.extend(this,{name:"monosynth",properties:{frequency:0,amp1:1,amp2:1,amp3:1,attack:1e4,decay:1e4,cutoff:.2,resonance:2.5,filterMult:.3,isLowPass:!0,amp:.6,detune2:.01,detune3:-.01,octave2:1,octave3:-1,glide:0,pan:0,channels:1},waveform:"Saw",note:function(e){this.frequency=e,t()>0&&i.run()}});var e=this.waveform;Object.defineProperty(this,"waveform",{get:function(){return e},set:function(i){e!==i&&(e=i,s=(new Gibberish[i]).callback,o=(new Gibberish[i]).callback,a=(new Gibberish[i]).callback)}});var i=new Gibberish.AD(this.attack,this.decay),t=i.getState,r=i.callback,n=(new Gibberish.Filter24).callback,s=new Gibberish[this.waveform](this.frequency,this.amp1).callback,o=new Gibberish[this.waveform](this.frequency2,this.amp2).callback,a=new Gibberish[this.waveform](this.frequency3,this.amp3).callback,h=(new Gibberish.OnePole).callback,b=Gibberish.makePanner(),l=[0,0];this.callback=function(e,i,u,c,p,f,d,m,v,y,g,G,k,_,w,P,S,A){if(2>t()){P>=1&&(P=.9999),e=h(e,1-P,P);var x=e;if(_>0)for(var M=0;_>M;M++)x*=2;else if(0>_)for(var M=0;M>_;M--)x/=2;var F=e;if(w>0)for(var M=0;w>M;M++)F*=2;else if(0>w)for(var M=0;M>w;M--)F/=2;x+=G>0?(2*e-e)*G:(e-e/2)*G,F+=k>0?(2*e-e)*k:(e-e/2)*k;var C=s(e,i,1)+o(x,u,1)+a(F,c,1),I=r(p,f),D=n(C,d+v*I,m,y,1)*I;return D*=g,l[0]=l[1]=D,1===A?l:b(D,S,l)}return l[0]=l[1]=0,l},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.MonoSynth.prototype=Gibberish._synth;